<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pembuat Kartu / Name Tag</title>
    <!-- QR Code Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <!-- html2canvas Library for Download -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* ============================================
           CSS CUSTOM PROPERTIES (VARIABLES)
           ============================================ */
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --success-gradient: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            --danger-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --warning-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            --light-gradient: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            --card-width: 400px;
            --card-height: 600px;
            --border-radius: 20px;
            --shadow: 0 20px 60px rgba(0,0,0,0.3);
            --transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
            --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        /* ============================================
           BASE & LAYOUT STYLES
           ============================================ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family);
            background: var(--primary-gradient);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            display: flex;
            gap: 40px;
            max-width: 1200px;
            width: 100%;
            flex-wrap: wrap;
            justify-content: center;
            align-items: stretch;
        }

        /* ============================================
           CARD STYLES
           ============================================ */
        .card-wrapper {
            position: relative;
            width: var(--card-width);
            height: var(--card-height);
            flex-shrink: 0;
        }

        .card-container {
            perspective: 1000px;
            width: 100%;
            height: 100%;
            position: relative;
        }

        .card-flipper {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.8s;
            transform-style: preserve-3d;
        }

        .card-flipper.flipped {
            transform: rotateY(180deg);
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- Front Card Base --- */
        .card-front {
            background-size: cover;
            background-position: center;
        }

        /* --- Front Card: Decorative Template --- */
        .card-front-decorative {
            background: var(--light-gradient);
        }
        .card-front-decorative .decorative-circles {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }
        .card-front-decorative .circle {
            position: absolute;
            opacity: 0.6;
            transition: var(--transition);
        }
        /* Shape Styles */
        .shape-circle { border-radius: 50%; }
        .shape-square { border-radius: 0; }
        .shape-triangle { 
            clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
            -webkit-clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
        }
        .shape-hexagon { 
            clip-path: polygon(30% 0%, 70% 0%, 100% 30%, 100% 70%, 70% 100%, 30% 100%, 0% 70%, 0% 30%);
            -webkit-clip-path: polygon(30% 0%, 70% 0%, 100% 30%, 100% 70%, 70% 100%, 30% 100%, 0% 70%, 0% 30%);
        }
        .shape-star { 
            clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%, 50% 0%);
            -webkit-clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%, 50% 0%);
        }
        .shape-diamond { 
            clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
            -webkit-clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
        }
        .shape-pentagon { 
            clip-path: polygon(50% 0%, 100% 38%, 82% 100%, 18% 100%, 0% 38%);
            -webkit-clip-path: polygon(50% 0%, 100% 38%, 82% 100%, 18% 100%, 0% 38%);
        }
        .shape-heart {
            clip-path: path('M12,21.35l-1.45-1.32C5.4,15.36,2,12.27,2,8.5C2,5.41,4.42,3,7.5,3c1.74,0,3.41,0.81,4.5,2.08C13.09,3.81,14.76,3,16.5,3C19.58,3,22,5.41,22,8.5c0,3.77-3.4,6.86-8.55,11.53L12,21.35z');
            -webkit-clip-path: path('M12,21.35l-1.45-1.32C5.4,15.36,2,12.27,2,8.5C2,5.41,4.42,3,7.5,3c1.74,0,3.41,0.81,4.5,2.08C13.09,3.81,14.76,3,16.5,3C19.58,3,22,5.41,22,8.5c0,3.77-3.4,6.86-8.55,11.53L12,21.35z');
            transform: scale(2);
        }
        .shape-arrow {
            clip-path: polygon(0% 20%, 60% 20%, 60% 0%, 100% 50%, 60% 100%, 60% 80%, 0% 80%);
            -webkit-clip-path: polygon(0% 20%, 60% 20%, 60% 0%, 100% 50%, 60% 100%, 60% 80%, 0% 80%);
        }
        .shape-cross {
            clip-path: polygon(20% 0%, 80% 0%, 80% 20%, 100% 20%, 100% 80%, 80% 80%, 80% 100%, 20% 100%, 20% 80%, 0% 80%, 0% 20%, 20% 20%);
            -webkit-clip-path: polygon(20% 0%, 80% 0%, 80% 20%, 100% 20%, 100% 80%, 80% 80%, 80% 100%, 20% 100%, 20% 80%, 0% 80%, 0% 20%, 20% 20%);
        }

        .card-front-decorative .green-side-left, .card-front-decorative .green-side-right {
            position: absolute;
            top: 75%;
            width: 58%;
            height: 60px;
            background: var(--success-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            writing-mode: vertical-lt;
            text-orientation: mixed;
            z-index: 0;
            transform-origin: center center;
        }
        .card-front-decorative .green-side-left { left: -24%; transform: translateY(-50%) rotate(-90deg); border-radius: 0 0 50px 0; }
        .card-front-decorative .green-side-right { right: -24%; transform: translateY(-50%) rotate(90deg); border-radius: 0 0 0 50px; }
        .card-front-decorative .dept-text { color: white; font-weight: bold; font-size: 16px; padding: 10px 0; }

        /* --- Front Card: Plain Template --- */
        .card-front-plain::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            z-index: 1;
        }
        
        .card-front-plain .card-header {
            background: transparent;
            z-index: 2;
            padding-top: 30px;
        }
        .card-front-plain .card-footer {
            background: transparent;
            z-index: 2;
            padding-bottom: 30px;
        }
        .card-front-plain .company-name {
            color: white;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.7);
        }
        .card-front-plain .name-text, .card-front-plain .nip-text {
            color: white;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.7);
        }
        .card-front-plain .logo-container {
            border-color: rgba(255, 255, 255, 0.5);
        }
        .card-front-plain .dept-text { display: none; }

        /* --- Shared Front Card Elements --- */
        .card-header {
            padding: 15px;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            position: relative;
            flex-shrink: 0;
        }
        .logo-container {
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            overflow: hidden;
        }
        .logo-image { max-width: 100%; max-height: 100%; object-fit: contain; }
        .logo-placeholder { font-size: 24px; color: #adb5bd; }
        .company-name { font-size: 18px; font-weight: bold; color: #333; }
        .card-image-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
            position: relative;
            min-height: 0;
        }
        .person-image {
            width: 300px;
            height: 350px;
            background: url('data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCg0KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4NCjwhLS0gVXBsb2FkZWQgdG86IFNWRyBSZXBvLCB3d3cuc3ZncmVwby5jb20sIEdlbmVyYXRvcjogU1ZHIFJlcG8gTWl4ZXIgVG9vbHMgLS0+DQo8c3ZnIGhlaWdodD0iODAwcHgiIHdpZHRoPSI4MDBweCIgdmVyc2lvbj0iMS4xIiBpZD0iX3gzMl8iIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIA0KCSB2aWV3Qm94PSIwIDAgNTEyIDUxMiIgIHhtbDpzcGFjZT0icHJlc2VydmUiPg0KPHN0eWxlIHR5cGU9InRleHQvY3NzIj4NCgkuc3Qwe2ZpbGw6IzAwMDAwMDt9DQo8L3N0eWxlPg0KPGc+DQoJPHBhdGggY2xhc3M9InN0MCIgZD0iTTM2NC4wMzIsMzU1LjAzNWMtMy44NjItMS40NDYtOC4wNzItMy40MzYtMTIuMzUtNS43OTRsLTcxLjU3LDk4LjkzNWwtNS4wOS02NC44MTRoLTM4LjAzM2wtNS4wOTEsNjQuODE0DQoJCWwtNzEuNTY5LTk4LjkzNWMtNC40MDgsMi40NjYtOC42NTYsNC40ODctMTIuMzYxLDUuNzk0Yy0zNy40NzgsMTMuMTkzLTEyOS41NDksNTEuMTM2LTEyMy42MDcsMTIyLjIxDQoJCUMyNS43ODcsNDk0LjMwMSwxMTkuNTgyLDUxMiwyNTYuMDA2LDUxMmMxMzYuNDEzLDAsMjMwLjIwOC0xNy42OTksMjMxLjYzNC0zNC43NTUNCgkJQzQ5My41ODMsNDA2LjEwMiw0MDEuMjczLDM2OC45NjEsMzY0LjAzMiwzNTUuMDM1eiIvPg0KCTxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik0xNzEuNTAxLDIwOC4yNzFjNS4yMSwyOS41MTYsMTMuOTY2LDU1LjU1NCwyNS40OTQsNjguMzhjMCwxNS4zODIsMCwyNi42MDQsMCwzNS41ODcNCgkJYzAsMC45MDItMC4xNTgsMS44NTItMC40MTYsMi44MzNsNDAuNDEsMTkuNDYydjI4LjU0NWgzOC4wMzN2LTI4LjU0NWw0MC4zOS0xOS40NTJjLTAuMjU4LTAuOTgxLTAuNDE2LTEuOTMyLTAuNDE2LTIuODQzDQoJCWMwLTguOTgzLDAtMjAuMjA1LDAtMzUuNTg3YzExLjU0OC0xMi44MjYsMjAuMzA0LTM4Ljg2NCwyNS41MTQtNjguMzhjMTIuMTQzLTQuMzM4LDE5LjA5Ni0xMS4yODEsMjcuNzYyLTQxLjY1OA0KCQljOS4yMzEtMzIuMzU4LTEzLjg3Ni0zMS4yNTgtMTMuODc2LTMxLjI1OGMxOC42OS02MS44NzMtNS45MjItMTIwLjAyMi00Ny4xMjQtMTE1Ljc1M2MtMjguNDI2LTQ5LjczLTEyMy42MjcsMTEuMzYtMTUzLjQ4LDcuMTAyDQoJCWMwLDE3LjA1NSw3LjExMiwyOS44NDIsNy4xMTIsMjkuODQyYy0xMC4zNzksMTkuNjktNi4zNzgsNTguOTUxLTMuNDQ2LDc4LjgwOWMtMS43MDQtMC4wMy0yMi42MDIsMC4xODgtMTMuNzI4LDMxLjI1OA0KCQlDMTUyLjQwNSwxOTYuOTksMTU5LjMzOCwyMDMuOTM0LDE3MS41MDEsMjA4LjI3MXoiLz4NCjwvZz4NCjwvc3ZnPg==') center/cover;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            overflow: hidden;
            max-width: 100%;
            max-height: 100%;
            flex-shrink: 0;
        }
        .person-image img { width: 100%; height: 100%; object-fit: cover; }
        .card-footer {
            padding: 15px;
            text-align: center;
            position: relative;
            flex-shrink: 0;
        }
        .name-text { font-size: 24px; font-weight: bold; text-shadow: 2px 2px 4px rgba(0,0,0,0.2); }
        .nip-text { font-size: 16px; margin-top: 5px; text-shadow: 1px 1px 2px rgba(0,0,0,0.2); display: none; }
        .nip-text.show { display: block; }

        /* --- Back Card --- */
        .card-back {
            background: var(--primary-gradient);
            padding: 20px;
            transform: rotateY(180deg);
            color: white;
            background-size: cover;
            background-position: center;
            display: flex;
            flex-direction: column;
        }
        .card-back::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1;
        }
        .card-back > * { position: relative; z-index: 2; }
        .back-title { 
            font-size: 28px; 
            font-weight: bold; 
            text-transform: uppercase; 
            letter-spacing: 2px; 
            text-align: center; 
            margin-bottom: 20px;
            flex-shrink: 0;
        }
        .back-info { 
            flex: 1; 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            gap: 15px; 
            margin-bottom: 20px;
            overflow-y: auto;
            min-height: 0;
        }
        .info-item { 
            font-size: 18px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            text-align: center;
            padding: 5px 0;
        }
        .qr-container { 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            margin-top: auto;
            flex-shrink: 0;
        }
        .qr-code {
            width: 180px;
            height: 180px;
            background: white;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            padding: 15px;
            position: relative;
        }
        .qr-code canvas, .qr-code img { display: block; width: 100% !important; height: 100% !important; }
        .qr-info {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 10px;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }
        .qr-code:hover .qr-info { opacity: 1; }

        /* ============================================
           CONTROL PANEL STYLES
           ============================================ */
        .control-panel {
            background: white;
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 450px;
            height: var(--card-height);
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }
        .control-panel::-webkit-scrollbar { width: 8px; }
        .control-panel::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
        .control-panel::-webkit-scrollbar-thumb { background: var(--primary-gradient); border-radius: 10px; }

        .panel-title { font-size: 24px; font-weight: bold; margin-bottom: 25px; color: #333; text-align: center; padding-bottom: 15px; border-bottom: 2px solid #f0f0f0; }
        .panel-section { margin-bottom: 25px; }
        .section-title { font-size: 14px; font-weight: 600; color: #667eea; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 1px; display: flex; align-items: center; gap: 8px; }
        .input-group { margin-bottom: 18px; }
        .input-label { display: block; margin-bottom: 8px; color: #555; font-weight: 500; font-size: 13px; }
        .input-field {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            transition: var(--transition);
        }
        .input-field:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        .color-input { height: 45px; cursor: pointer; }

        /* --- Template Selector --- */
        .template-selector {
            display: flex;
            gap: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 5px;
        }
        .template-option {
            flex: 1;
            padding: 10px;
            text-align: center;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 13px;
            font-weight: 500;
            border: 2px solid transparent;
        }
        .template-option input[type="radio"] { display: none; }
        .template-option input[type="radio"]:checked + span {
            color: white;
        }
        .template-option.selected {
            background: var(--primary-gradient);
            color: white;
        }
        .template-option:not(.selected):hover {
            background-color: #f0f0f0;
        }

        /* --- Background Control Styles --- */
        .bg-control-group {
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .bg-type-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        .bg-type-selector label {
            flex: 1;
            padding: 8px;
            text-align: center;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 13px;
        }
        .bg-type-selector input[type="radio"] { display: none; }
        .bg-type-selector input[type="radio"]:checked + label {
            background: var(--primary-gradient);
            color: white;
            border-color: #667eea;
        }
        .bg-option-content { display: none; }
        .bg-option-content.active { display: block; }

        /* --- File Upload --- */
        .file-upload-wrapper { position: relative; overflow: hidden; display: inline-block; width: 100%; }
        .file-upload-input { position: absolute; left: -9999px; }
        .file-upload-label {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 12px;
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 14px;
            color: #495057;
        }
        .file-upload-label:hover { background: #e9ecef; border-color: #667eea; }
        .file-upload-label.has-file { background: #d4edda; border-color: #28a745; color: #155724; }
        .file-upload-label.photo-upload { background: #fff3cd; border-color: #ffc107; color: #856404; }
        .file-upload-label.photo-upload.has-file { background: #d1ecf1; border-color: #17a2b8; color: #0c5460; }
        .file-name { flex: 1; text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* --- Font Control Styles --- */
        .font-control-group {
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .font-element-selector {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .font-element-label {
            font-size: 13px;
            font-weight: 500;
            color: #555;
        }
        .font-dropdown {
            width: 100%;
            padding: 8px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 13px;
            background-color: white;
            transition: var(--transition);
        }
        .font-dropdown:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        .custom-font-upload {
            margin-top: 10px;
        }
        .font-preview {
            margin-top: 10px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 8px;
            text-align: center;
            font-size: 16px;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* --- Font Size Control Styles --- */
        .font-size-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        .font-size-slider {
            flex-grow: 1;
            -webkit-appearance: none;
            appearance: none;
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            outline: none;
        }
        .font-size-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            background: var(--primary-gradient);
            border-radius: 50%;
            cursor: pointer;
        }
        .font-size-slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            background: var(--primary-gradient);
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }
        .font-size-value {
            min-width: 45px;
            text-align: center;
            font-weight: 600;
            color: #667eea;
            font-size: 13px;
        }

        /* --- Decorative Elements Control Styles --- */
        .element-controls {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border: 1px solid #e0e0e0;
            position: relative;
        }
        .element-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .element-title {
            font-weight: 600;
            color: #667eea;
            font-size: 13px;
        }
        .element-actions {
            display: flex;
            gap: 5px;
        }
        .element-properties {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        .property-group {
            display: flex;
            flex-direction: column;
        }
        .property-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }
        
        /* --- Position Control Styles --- */
        .position-control {
            grid-column: 1 / -1;
            margin-top: 10px;
        }
        .position-sliders {
            display: flex;
            gap: 10px;
            margin-top: 5px;
        }
        .position-slider-group {
            flex: 1;
        }
        .position-slider-label {
            font-size: 11px;
            color: #666;
            margin-bottom: 3px;
            display: flex;
            justify-content: space-between;
        }
        .position-slider {
            width: 100%;
            -webkit-appearance: none;
            appearance: none;
            height: 4px;
            background: #e0e0e0;
            border-radius: 2px;
            outline: none;
        }
        .position-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 14px;
            height: 14px;
            background: var(--primary-gradient);
            border-radius: 50%;
            cursor: pointer;
        }
        .position-slider::-moz-range-thumb {
            width: 14px;
            height: 14px;
            background: var(--primary-gradient);
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }

        /* --- Add Element Button --- */
        .add-element-btn {
            width: 100%;
            padding: 10px;
            background: var(--success-gradient);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 10px;
        }
        .add-element-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(17, 153, 142, 0.3);
        }

        /* --- Delete Element Button --- */
        .delete-element-btn {
            background: var(--danger-gradient);
            color: white;
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            font-size: 11px;
            cursor: pointer;
            transition: var(--transition);
        }
        .delete-element-btn:hover {
            transform: scale(1.05);
        }

        /* --- Buttons --- */
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .btn:hover { transform: translateY(-2px); }
        .btn-primary { background: var(--primary-gradient); color: white; }
        .btn-primary:hover { box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4); }
        .btn-secondary { background: #f0f0f0; color: #333; }
        .btn-secondary:hover { background: #e0e0e0; }
        .btn-success { background: var(--success-gradient); color: white; }
        .btn-success:hover { box-shadow: 0 5px 20px rgba(17, 153, 142, 0.4); }
        .btn-warning { background: var(--danger-gradient); color: white; }
        .btn-warning:hover { box-shadow: 0 5px 20px rgba(245, 87, 108, 0.4); }
        .btn-small { padding: 6px 10px; font-size: 12px; }

        .btn-group { display: flex; gap: 10px; margin-top: auto; padding-top: 20px; }
        .flip-btn { width: 100%; margin-top: 15px; background: var(--success-gradient); }
        .action-section { margin-top: 20px; padding-top: 20px; border-top: 2px solid #f0f0f0; }
        .action-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        .action-btn {
            padding: 10px;
            border: none;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            color: white;
            position: relative;
            overflow: hidden;
        }
        .action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        .action-btn:hover::before { left: 100%; }
        .download-front { background: var(--primary-gradient); }
        .download-back { background: var(--danger-gradient); }
        .download-both, .print-btn { grid-column: 1 / -1; }
        .download-both { background: var(--success-gradient); }
        .print-btn { background: var(--warning-gradient); }

        /* ============================================
           UTILITY & EFFECT STYLES
           ============================================ */
        .flip-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255,255,255,0.9);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            color: #666;
            z-index: 10;
            transition: var(--transition);
        }
        .card-flipper.flipped .flip-indicator {
            background: rgba(102, 126, 234, 0.9);
            color: white;
        }
        .keyboard-hint {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 12px;
            opacity: 0.8;
            transition: opacity 0.3s;
        }
        .keyboard-hint:hover { opacity: 1; }

        /* --- Loading Overlay --- */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        .loading-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
        }
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .loading-text { color: #333; font-size: 16px; font-weight: 600; }
        .progress-bar {
            width: 200px;
            height: 6px;
            background: #f0f0f0;
            border-radius: 3px;
            margin: 15px auto 0;
            overflow: hidden;
            display: none;
        }
        .progress-fill {
            height: 100%;
            background: var(--primary-gradient);
            border-radius: 3px;
            width: 0%;
            transition: width 0.3s ease;
        }

        /* --- Print Styles --- */
        @media print {
            body { background: white; padding: 0; }
            .container { display: block; max-width: none; gap: 0; padding: 20px; }
            .control-panel, .keyboard-hint, .flip-indicator { display: none !important; }
            .card-wrapper {
                width: var(--card-width);
                height: var(--card-height);
                margin: 0 auto 20px;
                page-break-inside: avoid;
                break-inside: avoid;
            }
            .card-flipper { transform: none !important; }
            .card-face { position: relative; backface-visibility: visible; transform: none !important; }
            .card-back { transform: none !important; }
        }

        /* --- Responsive --- */
        @media (min-width: 769px) and (max-width: 1024px) {
            .container { flex-direction: column; align-items: center; }
            .card-wrapper, .control-panel {
                width: 350px;
                height: 525px;
            }
            .control-panel { max-width: 350px; }
            .keyboard-hint { display: none; }
        }

/* Tambahkan CSS untuk toggle switch */
.toggle-switch {
    position: relative;
    display: inline-block;
    width: 60px;
    height: 30px;
}

.toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.toggle-label {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: var(--transition);
    border-radius: 30px;
    /* Tambahkan garis tepi */
    border: 2px solid #ddd;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.toggle-label:before {
    position: absolute;
    content: "";
    height: 22px;
    width: 22px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    transition: var(--transition);
    border-radius: 50%;
    /* Tambahkan garis tepi pada tombol */
    border: 1px solid #eee;
    box-shadow: 0 2px 3px rgba(0,0,0,0.1);
}



input:checked + .toggle-label:before {
    transform: translateX(30px);
    /* Tambahkan garis tepi pada tombol saat aktif */
    border-color: #667eea;
    box-shadow: 0 2px 5px rgba(102, 126, 234, 0.2);
}

input:checked + .toggle-label:before {
    transform: translateX(30px);
}

/* Tambahkan CSS untuk green side bars saat disembunyikan */
.green-side-left.hidden, .green-side-right.hidden {
    display: none !important;
}

/* Tambahkan CSS untuk tombol export/import */
.setting-actions {
    display: flex;
    gap: 10px;
    margin-top: 15px;
}

.export-settings {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.import-settings {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
}


/* ============================================
   LOGO CONTAINER TRANSPARANSI
   ============================================ */

/* Pastikan container logo memiliki transisi yang halus */
#logoContainer {
    min-height: 60px; /* Tetap mempertahankan tinggi minimum */
    display: flex !important;
    align-items: center;
    justify-content: center;
    /* Tambahkan transisi untuk efek fade in/out */
    transition: opacity 0.3s ease;
}

/* Class ini akan membuat SEMUA isi container menjadi transparan */
#logoContainer.logo-hidden {
    opacity: 0; /* Membuat seluruh container dan isinya tak terlihat */
    /* Pastikan tidak ada background atau border yang muncul */
    background: transparent !important;
    border: transparent !important;
    /* Agar tidak bisa diklik saat tersembunyi (opsional, tapi bagus) */
    pointer-events: none;
}

/* Container untuk toggle logo */
.logo-toggle-container {
    padding: 8px 0;
    border-top: 1px solid #e0e0e0;
    margin-top: 10px;
}
 
 </style>
</head>
<body>

    <div class="container">
        <!-- Card Section -->
        <div class="card-wrapper">
            <div class="flip-indicator" id="flipIndicator">Depan</div>
            <div class="card-container">
                <div class="card-flipper" id="cardFlipper">
                    <!-- Front Side -->
                    <div class="card-face card-front card-front-decorative" id="cardFront">
                        <!-- Decorative Elements Container -->
                        <div class="decorative-circles" id="decorativeCirclesFront"></div>
                        <div class="green-side-left" id="greenSideLeft"><div class="dept-text" id="deptTextLeft">OPERATOR</div></div>
                        <div class="green-side-right" id="greenSideRight"><div class="dept-text" id="deptTextRight">OPERATOR</div></div>
                        
                        <div class="card-header">
                            <div class="logo-container" id="logoContainer">
                                <div class="logo-placeholder" id="logoPlaceholder"><img src="data:image/x-icon;base64,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AGsAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACiskN8MkHi+4AAAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///4///8AAP//8A///wAA//+AAP//AAD/+AAAD/8AAP/AAAAD/wAA/wAAAAB/AAD8AAAAAD8AAPgAAAAAD5YA8AAAAAAHAADgAAAAAAMAAMAAAAAAAQAAgAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAf//gAAAAAABAACAAAAAAAEAAMAAAAAAAwAAwAAAAAADAADAAAAAAAMAAMAAAAAAAwAAwAAAAAADAADAAAAAAAMAAMAAAAAAAwAAwAAAAAADAADAAAAAAAMAAIAAAAAAAQAAgAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAABAADgAAAAAAcAAPAAAAAAD///+AAAAAAPAAD4AAAAAB8AAPwAAAAAPwAA//wAAB//AAD//8AD//8AAP//+B///wAA///8P///AAA="></div>
                                <img class="logo-image" id="logoImage" style="display: none;" alt="Logo">
                            </div>
                            <div class="company-name" id="companyName">UPT SD NEGERI 067953</div>
                        </div>
                        
                        <div class="card-image-container">
                            <div class="person-image" id="personImage">
                                <img id="personImg" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCg0KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4NCjwhLS0gVXBsb2FkZWQgdG86IFNWRyBSZXBvLCB3d3cuc3ZncmVwby5jb20sIEdlbmVyYXRvcjogU1ZHIFJlcG8gTWl4ZXIgVG9vbHMgLS0+DQo8c3ZnIGhlaWdodD0iODAwcHgiIHdpZHRoPSI4MDBweCIgdmVyc2lvbj0iMS4xIiBpZD0iX3gzMl8iIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIA0KCSB2aWV3Qm94PSIwIDAgNTEyIDUxMiIgIHhtbDpzcGFjZT0icHJlc2VydmUiPg0KPHN0eWxlIHR5cGU9InRleHQvY3NzIj4NCgkuc3Qwe2ZpbGw6IzAwMDAwMDt9DQo8L3N0eWxlPg0KPGc+DQoJPHBhdGggY2xhc3M9InN0MCIgZD0iTTM2NC4wMzIsMzU1LjAzNWMtMy44NjItMS40NDYtOC4wNzItMy40MzYtMTIuMzUtNS43OTRsLTcxLjU3LDk4LjkzNWwtNS4wOS02NC44MTRoLTM4LjAzM2wtNS4wOTEsNjQuODE0DQoJCWwtNzEuNTY5LTk4LjkzNWMtNC40MDgsMi40NjYtOC42NTYsNC40ODctMTIuMzYxLDUuNzk0Yy0zNy40NzgsMTMuMTkzLTEyOS41NDksNTEuMTM2LTEyMy42MDcsMTIyLjIxDQoJCUMyNS43ODcsNDk0LjMwMSwxMTkuNTgyLDUxMiwyNTYuMDA2LDUxMmMxMzYuNDEzLDAsMjMwLjIwOC0xNy42OTksMjMxLjYzNC0zNC43NTUNCgkJQzQ5My41ODMsNDA2LjEwMiw0MDEuMjczLDM2OC45NjEsMzY0LjAzMiwzNTUuMDM1eiIvPg0KCTxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik0xNzEuNTAxLDIwOC4yNzFjNS4yMSwyOS41MTYsMTMuOTY2LDU1LjU1NCwyNS40OTQsNjguMzhjMCwxNS4zODIsMCwyNi42MDQsMCwzNS41ODcNCgkJYzAsMC45MDItMC4xNTgsMS44NTItMC40MTYsMi44MzNsNDAuNDEsMTkuNDYydjI4LjU0NWgzOC4wMzN2LTI4LjU0NWw0MC4zOS0xOS40NTJjLTAuMjU4LTAuOTgxLTAuNDE2LTEuOTMyLTAuNDE2LTIuODQzDQoJCWMwLTguOTgzLDAtMjAuMjA1LDAtMzUuNTg3YzExLjU0OC0xMi44MjYsMjAuMzA0LTM4Ljg2NCwyNS41MTQtNjguMzhjMTIuMTQzLTQuMzM4LDE5LjA5Ni0xMS4yODEsMjcuNzYyLTQxLjY1OA0KCQljOS4yMzEtMzIuMzU4LTEzLjg3Ni0zMS4yNTgtMTMuODc2LTMxLjI1OGMxOC42OS02MS44NzMtNS45MjItMTIwLjAyMi00Ny4xMjQtMTE1Ljc1M2MtMjguNDI2LTQ5LjczLTEyMy42MjcsMTEuMzYtMTUzLjQ4LDcuMTAyDQoJCWMwLDE3LjA1NSw3LjExMiwyOS44NDIsNy4xMTIsMjkuODQyYy0xMC4zNzksMTkuNjktNi4zNzgsNTguOTUxLTMuNDQ2LDc4LjgwOWMtMS43MDQtMC4wMy0yMi42MDIsMC4xODgtMTMuNzI4LDMxLjI1OA0KCQlDMTUyLjQwNSwxOTYuOTksMTU5LjMzOCwyMDMuOTM0LDE3MS41MDEsMjA4LjI3MXoiLz4NCjwvZz4NCjwvc3ZnPg==" alt="Person" style="display: block;">
                             </div>
                        </div>
                        
                        <div class="card-footer">
                            <div class="name-text" id="nameText">SUGANDI,S.Kom</div>
                            <div class="nip-text" id="nipText">NIP: 1234567890</div>
                        </div>
                    </div>
                    <!-- Back Side -->
                    <div class="card-face card-back" id="cardBack">
                        <!-- Decorative Elements Container for Back -->
                        <div class="decorative-circles" id="decorativeCirclesBack"></div>
                        <div class="back-title">CONTACT INFO</div>
                        <div class="back-content">
                            <div class="back-info">
                                <div class="info-item"><span id="backNameDisplay">Sugandi,S.Kom</span></div>
                                <div class="info-item"><span id="backNipDisplay">NIP</span></div>
                                <div class="info-item"><span id="backEmailDisplay">sugandigtexs@gmail.com</span></div>
                                <div class="info-item"><span id="backPhoneDisplay">+62 852 - 0646 - 1713</span></div>
                                <div class="info-item"><span id="backPositionDisplay">OPERATOR</span></div>
                                <div class="info-item"><span id="backOfficeDisplay">Medan Deli</span></div>
                            </div>
                            <div class="qr-container">
                                <div class="qr-code" id="qrcode"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Control Panel Section -->
        <div class="control-panel">
            <h2 class="panel-title">📝 Panel Kontrol</h2>
            <form id="controlForm">
                <!-- Template Section -->
                <div class="panel-section">
                    <div class="section-title"><span>🎨</span> Template Kartu</div>
                    <div class="template-selector">
                        <div class="template-option" data-template="decorative">
                            <input type="radio" id="templateDecorative" name="cardTemplate" value="decorative" checked>
                            <label for="templateDecorative"><span>✨ Dekoratif</span></label>
                        </div>
                        <div class="template-option" data-template="plain">
                            <input type="radio" id="templatePlain" name="cardTemplate" value="plain">
                            <label for="templatePlain"><span>🖼️ Polos</span></label>
                        </div>
                    </div>
                </div>

                <!-- Decorative Elements Section -->
                <div class="panel-section" id="decorativeSection">
                    <div class="section-title"><span>✨</span> Elemen Dekoratif</div>
                    
                    <!-- Elements Container -->
                    <div id="elementsContainer"></div>
                    
                    <!-- Add Element Button -->
                    <button type="button" class="add-element-btn" id="addElementBtn">
                        <span>➕</span><span>Tambah Elemen Baru</span>
                    </button>
                </div>

                <!-- Branding Section -->
                <div class="panel-section">
                    <div class="section-title"><span>🏢</span> Branding</div>
                    <div class="input-group">
                        <label class="input-label">Logo Perusahaan</label>
                        <div class="file-upload-wrapper">
                            <input type="file" id="logoInput" class="file-upload-input" accept="image/*">
                            <label for="logoInput" class="file-upload-label" id="logoLabel">
                                <span>📁</span><span class="file-name">Pilih file logo...</span>
                            </label>
                        </div>
                            <!-- Tambahkan toggle switch di sini -->
    <div class="logo-toggle-container" style="margin-top: 10px; display: flex; align-items: center; justify-content: space-between;">
            <label class="toggle-switch">
            <input type="checkbox" id="logoToggle" checked>
            <span class="toggle-label"></span>
        </label>
    </div>
                    </div>
                    <div class="input-group">
                        <label class="input-label">Nama Perusahaan</label>
                        <input type="text" class="input-field" id="companyInput" value="UPT SD NEGERI 067953">
                    </div>
                </div>

                <!-- Font Section -->
                <div class="panel-section">
                    <div class="section-title"><span>🔤</span> Kustomisasi Font</div>
                    
                    <!-- Font for Company Name -->
                    <div class="font-control-group">
                        <div class="font-element-selector">
                            <span class="font-element-label">Nama Perusahaan</span>
                        </div>
                        <select class="font-dropdown" id="companyFontSelect">
                            <option value="'Segoe UI', Tahoma, Geneva, Verdana, sans-serif">Segoe UI (Default)</option>
                            <option value="'Arial', sans-serif">Arial</option>
                            <option value="'Times New Roman', serif">Times New Roman</option>
                            <option value="'Courier New', monospace">Courier New</option>
                            <option value="'Georgia', serif">Georgia</option>
                            <option value="'Verdana', sans-serif">Verdana</option>
                            <option value="'Trebuchet MS', sans-serif">Trebuchet MS</option>
                            <option value="'Impact', sans-serif">Impact</option>
                            <option value="'Comic Sans MS', cursive">Comic Sans MS</option>
                            <option value="custom-company">Custom Font</option>
                        </select>
                        <div class="custom-font-upload" id="companyFontUpload" style="display: none;">
                            <div class="file-upload-wrapper">
                                <input type="file" id="companyFontInput" class="file-upload-input" accept=".ttf, .otf, .woff, .woff2">
                                <label for="companyFontInput" class="file-upload-label" id="companyFontLabel">
                                    <span>📁</span><span class="file-name">Pilih file font...</span>
                                </label>
                            </div>
                        </div>
                        <div class="font-size-control">
                            <label class="input-label" style="margin:0;">Ukuran:</label>
                            <input type="range" class="font-size-slider" id="companyFontSizeInput" min="12" max="32" value="18">
                            <span class="font-size-value" id="companyFontSizeValue">18px</span>
                        </div>
                        <div class="font-preview" id="companyFontPreview">UPT SD NEGERI 067953</div>
                    </div>
                    
                    <!-- Font for Name -->
                    <div class="font-control-group">
                        <div class="font-element-selector">
                            <span class="font-element-label">Nama Lengkap</span>
                        </div>
                        <select class="font-dropdown" id="nameFontSelect">
                            <option value="'Segoe UI', Tahoma, Geneva, Verdana, sans-serif">Segoe UI (Default)</option>
                            <option value="'Arial', sans-serif">Arial</option>
                            <option value="'Times New Roman', serif">Times New Roman</option>
                            <option value="'Courier New', monospace">Courier New</option>
                            <option value="'Georgia', serif">Georgia</option>
                            <option value="'Verdana', sans-serif">Verdana</option>
                            <option value="'Trebuchet MS', sans-serif">Trebuchet MS</option>
                            <option value="'Impact', sans-serif">Impact</option>
                            <option value="'Comic Sans MS', cursive">Comic Sans MS</option>
                            <option value="custom-name">Custom Font</option>
                        </select>
                        <div class="custom-font-upload" id="nameFontUpload" style="display: none;">
                            <div class="file-upload-wrapper">
                                <input type="file" id="nameFontInput" class="file-upload-input" accept=".ttf, .otf, .woff, .woff2">
                                <label for="nameFontInput" class="file-upload-label" id="nameFontLabel">
                                    <span>📁</span><span class="file-name">Pilih file font...</span>
                                </label>
                            </div>
                        </div>
                        <div class="font-size-control">
                            <label class="input-label" style="margin:0;">Ukuran:</label>
                            <input type="range" class="font-size-slider" id="nameFontSizeInput" min="16" max="40" value="24">
                            <span class="font-size-value" id="nameFontSizeValue">24px</span>
                        </div>
                        <div class="font-preview" id="nameFontPreview">SUGANDI,S.Kom</div>
                    </div>
                    
                    <!-- Font for Other Text -->
                    <div class="font-control-group">
                        <div class="font-element-selector">
                            <span class="font-element-label">Teks Lainnya</span>
                        </div>
                        <select class="font-dropdown" id="otherFontSelect">
                            <option value="'Segoe UI', Tahoma, Geneva, Verdana, sans-serif">Segoe UI (Default)</option>
                            <option value="'Arial', sans-serif">Arial</option>
                            <option value="'Times New Roman', serif">Times New Roman</option>
                            <option value="'Courier New', monospace">Courier New</option>
                            <option value="'Georgia', serif">Georgia</option>
                            <option value="'Verdana', sans-serif">Verdana</option>
                            <option value="'Trebuchet MS', sans-serif">Trebuchet MS</option>
                            <option value="'Impact', sans-serif">Impact</option>
                            <option value="'Comic Sans MS', cursive">Comic Sans MS</option>
                            <option value="custom-other">Custom Font</option>
                        </select>
                        <div class="custom-font-upload" id="otherFontUpload" style="display: none;">
                            <div class="file-upload-wrapper">
                                <input type="file" id="otherFontInput" class="file-upload-input" accept=".ttf, .otf, .woff, .woff2">
                                <label for="otherFontInput" class="file-upload-label" id="otherFontLabel">
                                    <span>📁</span><span class="file-name">Pilih file font...</span>
                                </label>
                            </div>
                        </div>
                        <div class="font-size-control">
                            <label class="input-label" style="margin:0;">Ukuran:</label>
                            <input type="range" class="font-size-slider" id="otherFontSizeInput" min="10" max="24" value="16">
                            <span class="font-size-value" id="otherFontSizeValue">16px</span>
                        </div>
                        <div class="font-preview" id="otherFontPreview">NIP: 1234567890</div>
                    </div>
                </div>

                <!-- Background Section -->
                <div class="panel-section">
                    <div class="section-title"><span>🖼️</span> Latar Belakang</div>
                    
                    <!-- Front Background Control -->
                    <div class="bg-control-group">
                        <div class="input-label">Background Depan</div>
                        <div class="bg-type-selector">
                            <input type="radio" id="frontBgColor" name="frontBgType" value="color" checked>
                            <label for="frontBgColor">Warna</label>
                            <input type="radio" id="frontBgImage" name="frontBgType" value="image">
                            <label for="frontBgImage">Gambar</label>
                        </div>
                        <div class="bg-option-content active" id="frontBgColorContent">
                            <input type="color" class="input-field color-input" id="frontBgColorInput" value="#f5f7fa">
                        </div>
                        <div class="bg-option-content" id="frontBgImageContent">
                            <div class="file-upload-wrapper">
                                <input type="file" id="frontBgInput" class="file-upload-input" accept="image/*">
                                <label for="frontBgInput" class="file-upload-label" id="frontBgLabel">
                                    <span>🖼️</span><span class="file-name">Pilih gambar...</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Back Background Control -->
                    <div class="bg-control-group">
                        <div class="input-label">Background Belakang</div>
                        <div class="bg-type-selector">
                            <input type="radio" id="backBgColor" name="backBgType" value="color" checked>
                            <label for="backBgColor">Warna</label>
                            <input type="radio" id="backBgImage" name="backBgType" value="image">
                            <label for="backBgImage">Gambar</label>
                        </div>
                        <div class="bg-option-content active" id="backBgColorContent">
                            <input type="color" class="input-field color-input" id="backBgColorInput" value="#667eea">
                        </div>
                        <div class="bg-option-content" id="backBgImageContent">
                            <div class="file-upload-wrapper">
                                <input type="file" id="backBgInput" class="file-upload-input" accept="image/*">
                                <label for="backBgInput" class="file-upload-label" id="backBgLabel">
                                    <span>🖼️</span><span class="file-name">Pilih gambar...</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Personal Info Section -->
                <div class="panel-section">
                    <div class="section-title"><span>👤</span> Info Personal</div>
                    <div class="input-group">
                        <label class="input-label">Foto Person</label>
                        <div class="file-upload-wrapper">
                            <input type="file" id="photoInput" class="file-upload-input" accept="image/*">
                            <label for="photoInput" class="file-upload-label photo-upload" id="photoLabel">
                                <span>📷</span><span class="file-name">Pilih foto person...</span>
                            </label>
                        </div>
                    </div>
                    <div class="input-group"><label class="input-label">Nama Lengkap</label><input type="text" class="input-field" id="nameInput" value="SUGANDI,S.Kom"></div>
                    <div class="input-group"><label class="input-label">NIP</label><input type="text" class="input-field" id="nipInput" value="1234567890"></div>
                    <div class="input-group"><label class="input-label">Jabatan</label><input type="text" class="input-field" id="positionInput" value="OPERATOR"></div>
                    <!-- Tambahkan toggle untuk jabatan -->
    <div class="input-group">
        <label class="input-label">Tampilkan Jabatan di Depan</label>
        <div class="toggle-switch">
            <input type="checkbox" id="showPositionToggle" checked>
            <label for="showPositionToggle" class="toggle-label">
                <span class="toggle-inner"></span>
                <span class="toggle-switch"></span>
            </label>
        </div>
    </div>
                </div>

                <!-- Contact Section -->
                <div class="panel-section">
                    <div class="section-title"><span>📞</span> Kontak</div>
                    <div class="input-group"><label class="input-label">Email</label><input type="email" class="input-field" id="emailInput" value="sugandigtexs@gmail.com"></div>
                    <div class="input-group"><label class="input-label">Telepon</label><input type="tel" class="input-field" id="phoneInput" value="+62 852-0646-1713"></div>
                    <div class="input-group"><label class="input-label">Kantor</label><input type="text" class="input-field" id="officeInput" value="Medan Deli"></div>
                </div>

                <!-- Design Section -->
                <div class="panel-section">
                    <div class="section-title"><span>🎨</span> Desain</div>
                    <div class="input-group">
                        <label class="input-label">Warna Footer</label>
                        <input type="color" class="input-field color-input" id="headerColorInput" value="#ff6b6b">
                    </div>
                    <div class="input-group">
                        <label class="input-label">Warna Bilah Samping (Template Dekoratif)</label>
                        <input type="color" class="input-field color-input" id="sideBarColorInput" value="#11998e">
                    </div>
                </div>
            </form>

            <div class="btn-group">
                <button type="button" class="btn btn-primary" id="updateBtn">🔄 Update</button>
                <button type="button" class="btn btn-secondary" id="resetBtn">🔄 Reset</button>
            </div>
            <button type="button" class="btn btn-success flip-btn" id="flipBtn">🔄 Balik Kartu</button>

<!-- Action Section -->
<div class="action-section">
    <div class="section-title"><span>⚡</span> Aksi Cepat</div>
    <div class="action-grid">
        <button class="action-btn download-front" data-side="front">⬇️ Depan</button>
        <button class="action-btn download-back" data-side="back">⬇️ Belakang</button>
        <button class="action-btn download-both" data-side="both">⬇️ Kedua Sisi</button>
    </div>
    
    <!-- Tambahkan tombol export/import setting -->
    <div class="setting-actions" style="margin-top: 15px;">
        <button class="action-btn export-settings" id="exportSettingsBtn">
            💾 Export Setting
        </button>
        <button class="action-btn import-settings" id="importSettingsBtn">
            📂 Import Setting
        </button>
        <input type="file" id="importSettingsInput" accept=".json" style="display: none;">
    </div>
</div>

    
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text" id="loadingText">Memproses...</div>
            <div class="progress-bar" id="progressBar"><div class="progress-fill" id="progressFill"></div></div>
        </div>
    </div>

    <!-- Keyboard Hint -->
    <div class="keyboard-hint" id="keyboardHint">💡 Tekan <strong>F</strong> untuk balik kartu</div>

    <script>
document.addEventListener('DOMContentLoaded', () => {
    class IDCardMaker {
        constructor() {
// Fungsi untuk mengontrol tampilan logo
const logoToggle = document.getElementById('logoToggle');
const logoContainer = document.getElementById('logoContainer');

// Fungsi untuk memperbarui visibilitas logo (versi baru yang lebih sederhana)
function updateLogoVisibility() {
    if (logoToggle.checked) {
        // Jika toggle ON, hapus class 'logo-hidden'
        logoContainer.classList.remove('logo-hidden');
    } else {
        // Jika toggle OFF, tambahkan class 'logo-hidden'
        logoContainer.classList.add('logo-hidden');
    }
}

// Event listener untuk toggle switch
logoToggle.addEventListener('change', updateLogoVisibility);

// Inisialisasi status logo saat halaman dimuat
updateLogoVisibility();

// Event listener untuk toggle switch
logoToggle.addEventListener('change', updateLogoVisibility);

// Inisialisasi status logo saat halaman dimuat
updateLogoVisibility();

            // State Management
            this.state = {
                logoUrl: null,
                photoUrl: null,
                isFlipped: false,
                template: 'decorative',
                frontBackground: { type: 'color', value: '#f5f7fa' },
                backBackground: { type: 'color', value: '#667eea' },
                fonts: {
                    company: "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif",
                    name: "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif",
                    other: "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif"
                },
                fontSizes: {
                    company: 18,
                    name: 24,
                    other: 16
                },
                customFonts: {
                    company: null,
                    name: null,
                    other: null
                },
                sideBarColor: '#11998e',
                showPosition: true, // State untuk toggle jabatan
                decorativeElements: {
                    front: [
                        {
                            id: 1,
                            visible: true,
                            shape: 'circle',
                            size: 80,
                            x: 20,
                            y: 20,
                            color: 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)'
                        },
                        {
                            id: 2,
                            visible: true,
                            shape: 'circle',
                            size: 60,
                            x: 320,
                            y: 450,
                            color: 'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)'
                        },
                        {
                            id: 3,
                            visible: true,
                            shape: 'circle',
                            size: 40,
                            x: 350,
                            y: 20,
                            color: 'linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%)'
                        }
                    ],
                    back: []
                },
                nextId: 4
            };

            // Cache DOM Elements
            this.elements = {
                // Card
                cardFlipper: document.getElementById('cardFlipper'),
                flipIndicator: document.getElementById('flipIndicator'),
                cardFront: document.getElementById('cardFront'),
                cardBack: document.getElementById('cardBack'),
                // Decorative containers
                decorativeCirclesFront: document.getElementById('decorativeCirclesFront'),
                decorativeCirclesBack: document.getElementById('decorativeCirclesBack'),
                // Front Card Elements
                logoImage: document.getElementById('logoImage'),
                logoPlaceholder: document.getElementById('logoPlaceholder'),
                companyName: document.getElementById('companyName'),
                personImg: document.getElementById('personImg'),
                nameText: document.getElementById('nameText'),
                nipText: document.getElementById('nipText'),
                deptTextLeft: document.getElementById('deptTextLeft'),
                deptTextRight: document.getElementById('deptTextRight'),
                greenSideLeft: document.getElementById('greenSideLeft'),
                greenSideRight: document.getElementById('greenSideRight'),
                // Back Card Elements
                backNameDisplay: document.getElementById('backNameDisplay'),
                backNipDisplay: document.getElementById('backNipDisplay'),
                backEmailDisplay: document.getElementById('backEmailDisplay'),
                backPhoneDisplay: document.getElementById('backPhoneDisplay'),
                backPositionDisplay: document.getElementById('backPositionDisplay'),
                backOfficeDisplay: document.getElementById('backOfficeDisplay'),
                backTitle: document.querySelector('.back-title'),
                // QR Code
                qrcode: document.getElementById('qrcode'),
                // Font Elements
                companyFontSelect: document.getElementById('companyFontSelect'),
                nameFontSelect: document.getElementById('nameFontSelect'),
                otherFontSelect: document.getElementById('otherFontSelect'),
                companyFontUpload: document.getElementById('companyFontUpload'),
                nameFontUpload: document.getElementById('nameFontUpload'),
                otherFontUpload: document.getElementById('otherFontUpload'),
                companyFontInput: document.getElementById('companyFontInput'),
                nameFontInput: document.getElementById('nameFontInput'),
                otherFontInput: document.getElementById('otherFontInput'),
                companyFontLabel: document.getElementById('companyFontLabel'),
                nameFontLabel: document.getElementById('nameFontLabel'),
                otherFontLabel: document.getElementById('otherFontLabel'),
                companyFontPreview: document.getElementById('companyFontPreview'),
                nameFontPreview: document.getElementById('nameFontPreview'),
                otherFontPreview: document.getElementById('otherFontPreview'),
                // Font Size Elements
                companyFontSizeInput: document.getElementById('companyFontSizeInput'),
                nameFontSizeInput: document.getElementById('nameFontSizeInput'),
                otherFontSizeInput: document.getElementById('otherFontSizeInput'),
                companyFontSizeValue: document.getElementById('companyFontSizeValue'),
                nameFontSizeValue: document.getElementById('nameFontSizeValue'),
                otherFontSizeValue: document.getElementById('otherFontSizeValue'),
                // Decorative Elements Controls
                decorativeSection: document.getElementById('decorativeSection'),
                elementsContainer: document.getElementById('elementsContainer'),
                addElementBtn: document.getElementById('addElementBtn'),
                // Toggle untuk jabatan
                showPositionToggle: document.getElementById('showPositionToggle'),
                // Export/Import Elements
                exportSettingsBtn: document.getElementById('exportSettingsBtn'),
                importSettingsBtn: document.getElementById('importSettingsBtn'),
                importSettingsInput: document.getElementById('importSettingsInput'),
                // Inputs
                form: document.getElementById('controlForm'),
                logoInput: document.getElementById('logoInput'),
                photoInput: document.getElementById('photoInput'),
                // Background Inputs
                frontBgColorInput: document.getElementById('frontBgColorInput'),
                frontBgInput: document.getElementById('frontBgInput'),
                backBgColorInput: document.getElementById('backBgColorInput'),
                backBgInput: document.getElementById('backBgInput'),
                // Design Inputs
                headerColorInput: document.getElementById('headerColorInput'),
                sideBarColorInput: document.getElementById('sideBarColorInput'),
                // Buttons
                updateBtn: document.getElementById('updateBtn'),
                resetBtn: document.getElementById('resetBtn'),
                flipBtn: document.getElementById('flipBtn'),
                downloadBtns: document.querySelectorAll('.action-btn'),
                // UI
                loadingOverlay: document.getElementById('loadingOverlay'),
                loadingText: document.getElementById('loadingText'),
                progressBar: document.getElementById('progressBar'),
                progressFill: document.getElementById('progressFill'),
                keyboardHint: document.getElementById('keyboardHint'),
            };

            this.init();
        }

        init() {
            this.bindEvents();
            this.renderElementsControls();
            this.updateCard();
            this._addPrintStyles();
            this.showNotification('Selamat datang! Pilih template dan mulai kustomisasi.');
        }

        bindEvents() {
            // Form inputs (live update)
            this.elements.form.addEventListener('input', (e) => this.handleInputChange(e));
            
            // Template selector
            document.querySelectorAll('input[name="cardTemplate"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    this.updateTemplate();
                    this.updateTemplateSelection(e.target.value);
                });
            });

            // Add element button
            this.elements.addElementBtn.addEventListener('click', () => this.addNewElement());

            // Font selectors
            this.elements.companyFontSelect.addEventListener('change', (e) => this.handleFontChange(e, 'company'));
            this.elements.nameFontSelect.addEventListener('change', (e) => this.handleFontChange(e, 'name'));
            this.elements.otherFontSelect.addEventListener('change', (e) => this.handleFontChange(e, 'other'));

            // Font size sliders
            this.elements.companyFontSizeInput.addEventListener('input', (e) => this.handleFontSizeChange(e, 'company'));
            this.elements.nameFontSizeInput.addEventListener('input', (e) => this.handleFontSizeChange(e, 'name'));
            this.elements.otherFontSizeInput.addEventListener('input', (event) => this.handleFontSizeChange(event, 'other'));

            // Font file uploads
            this.elements.companyFontInput.addEventListener('change', (e) => this.handleFontUpload(e, 'company'));
            this.elements.nameFontInput.addEventListener('change', (e) => this.handleFontUpload(e, 'name'));
            this.elements.otherFontInput.addEventListener('change', (e) => this.handleFontUpload(e, 'other'));

            // File uploads
            this.elements.logoInput.addEventListener('change', (e) => this.handleFileUpload(e, 'logo'));
            this.elements.photoInput.addEventListener('change', (e) => this.handleFileUpload(e, 'photo'));
            this.elements.frontBgInput.addEventListener('change', (e) => this.handleFileUpload(e, 'frontBg'));
            this.elements.backBgInput.addEventListener('change', (e) => this.handleFileUpload(e, 'backBg'));

            // Background type selectors
            document.querySelectorAll('input[name="frontBgType"]').forEach(radio => {
                radio.addEventListener('change', () => this.toggleBackgroundOption('front'));
            });
            document.querySelectorAll('input[name="backBgType"]').forEach(radio => {
                radio.addEventListener('change', () => this.toggleBackgroundOption('back'));
            });

            // Toggle untuk jabatan
            if (this.elements.showPositionToggle) {
                this.elements.showPositionToggle.addEventListener('change', (e) => {
                    this.state.showPosition = e.target.checked;
                    this.updateCard();
                });
            }

            // Export/Import settings
            this.elements.exportSettingsBtn.addEventListener('click', () => this.exportSettings());
            
            this.elements.importSettingsBtn.addEventListener('click', () => {
                this.elements.importSettingsInput.click();
            });
            
            this.elements.importSettingsInput.addEventListener('change', (e) => this.importSettings(e));

            // Buttons
            this.elements.updateBtn.addEventListener('click', () => this.updateCard());
            this.elements.resetBtn.addEventListener('click', () => this.resetCard());
            this.elements.flipBtn.addEventListener('click', () => this.flipCard());
            this.elements.downloadBtns.forEach(btn => {
                btn.addEventListener('click', () => this.downloadCard(btn.dataset.side));
            });

            // Keyboard shortcut
            document.addEventListener('keydown', (e) => this.handleKeyboard(e));

            // Event delegation for dynamic elements
            this.elements.elementsContainer.addEventListener('change', (e) => {
                if (e.target.classList.contains('shape-select')) {
                    const elementId = parseInt(e.target.dataset.elementId);
                    this.updateElement(elementId, 'shape', e.target.value);
                }
            });

            this.elements.elementsContainer.addEventListener('input', (e) => {
                if (e.target.classList.contains('size-slider')) {
                    const elementId = parseInt(e.target.dataset.elementId);
                    const value = parseInt(e.target.value);
                    this.updateElement(elementId, 'size', value);
                } else if (e.target.classList.contains('position-slider')) {
                    const elementId = parseInt(e.target.dataset.elementId);
                    const property = e.target.dataset.property;
                    const value = parseInt(e.target.value);
                    this.updateElement(elementId, property, value);
                }
            });

            this.elements.elementsContainer.addEventListener('click', (e) => {
                if (e.target.classList.contains('delete-element-btn')) {
                    const elementId = parseInt(e.target.dataset.elementId);
                    this.removeElement(elementId);
                }
            });
        }

        updateTemplateSelection(value) {
            document.querySelectorAll('.template-option').forEach(option => {
                if (option.dataset.template === value) {
                    option.classList.add('selected');
                } else {
                    option.classList.remove('selected');
                }
            });
        }

        renderElementsControls() {
            const container = this.elements.elementsContainer;
            container.innerHTML = '';
            
            this.state.decorativeElements.front.forEach((element, index) => {
                const controlDiv = document.createElement('div');
                controlDiv.className = 'element-controls';
                controlDiv.dataset.elementId = element.id;
                
                controlDiv.innerHTML = `
                    <div class="element-header">
                        <span class="element-title">Elemen ${index + 1}</span>
                        <div class="element-actions">
                            <button type="button" class="delete-element-btn" data-element-id="${element.id}">Hapus</button>
                        </div>
                    </div>
                    <div class="element-properties">
                        <div class="property-group">
                            <label class="property-label">Bentuk</label>
                            <select class="input-field shape-select" data-element-id="${element.id}">
                                <option value="circle" ${element.shape === 'circle' ? 'selected' : ''}>Lingkaran</option>
                                <option value="square" ${element.shape === 'square' ? 'selected' : ''}>Persegi</option>
                                <option value="triangle" ${element.shape === 'triangle' ? 'selected' : ''}>Segitiga</option>
                                <option value="hexagon" ${element.shape === 'hexagon' ? 'selected' : ''}>Hexagon</option>
                                <option value="star" ${element.shape === 'star' ? 'selected' : ''}>Bintang</option>
                                <option value="diamond" ${element.shape === 'diamond' ? 'selected' : ''}>Berlian</option>
                                <option value="pentagon" ${element.shape === 'pentagon' ? 'selected' : ''}>Pentagon</option>
                                <option value="heart" ${element.shape === 'heart' ? 'selected' : ''}>Hati</option>
                                <option value="arrow" ${element.shape === 'arrow' ? 'selected' : ''}>Panah</option>
                                <option value="cross" ${element.shape === 'cross' ? 'selected' : ''}>Silang</option>
                            </select>
                        </div>
                        <div class="property-group">
                            <label class="property-label">Ukuran</label>
                            <input type="range" class="font-size-slider size-slider" min="20" max="120" value="${element.size}" 
                                   data-element-id="${element.id}">
                        </div>
                        <div class="position-control">
                            <label class="property-label">Posisi</label>
                            <div class="position-sliders">
                                <div class="position-slider-group">
                                    <div class="position-slider-label">
                                        <span>X:</span>
                                        <span class="position-value-x" data-element-id="${element.id}">${element.x}</span>
                                    </div>
                                    <input type="range" class="position-slider position-slider" min="0" max="380" value="${element.x}" 
                                           data-element-id="${element.id}" data-property="x">
                                    </div>
                                </div>
                                <div class="position-slider-group">
                                    <div class="position-slider-label">
                                        <span>Y:</span>
                                        <span class="position-value-y" data-element-id="${element.id}">${element.y}</span>
                                    </div>
                                    <input type="range" class="position-slider position-slider" min="0" max="580" value="${element.y}" 
                                           data-element-id="${element.id}" data-property="y">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                container.appendChild(controlDiv);
            });
            
            // Re-bind events for all elements
            this.bindAllElementEvents();
        }

        bindAllElementEvents() {
            this.state.decorativeElements.front.forEach(element => {
                // Shape change
                const shapeSelect = document.querySelector(`.shape-select[data-element-id="${element.id}"]`);
                if (shapeSelect) {
                    shapeSelect.addEventListener('change', (e) => {
                        this.updateElement(element.id, 'shape', e.target.value);
                    });
                }
                
                // Size change
                const sizeSlider = document.querySelector(`.size-slider[data-element-id="${element.id}"]`);
                if (sizeSlider) {
                    sizeSlider.addEventListener('input', (e) => {
                        const value = parseInt(e.target.value);
                        this.updateElement(element.id, 'size', value);
                    });
                }
                
                // Position changes
                const xSlider = document.querySelector(`.position-slider[data-element-id="${element.id}"][data-property="x"]`);
                const ySlider = document.querySelector(`.position-slider[data-element-id="${element.id}"][data-property="y"]`);
                
                if (xSlider) {
                    xSlider.addEventListener('input', (e) => {
                        const value = parseInt(e.target.value);
                        this.updateElement(element.id, 'x', value);
                        // Update position display
                        const xValueDisplay = document.querySelector(`.position-value-x[data-element-id="${element.id}"]`);
                        if (xValueDisplay) xValueDisplay.textContent = value;
                    });
                }
                
                if (ySlider) {
                    ySlider.addEventListener('input', (e) => {
                        const value = parseInt(e.target.value);
                        this.updateElement(element.id, 'y', value);
                        // Update position display
                        const yValueDisplay = document.querySelector(`.position-value-y[data-element-id="${element.id}"]`);
                        if (yValueDisplay) yValueDisplay.textContent = value;
                    });
                }
                
                // Delete element
                const deleteBtn = document.querySelector(`.delete-element-btn[data-element-id="${element.id}"]`);
                if (deleteBtn) {
                    deleteBtn.addEventListener('click', () => {
                        this.removeElement(element.id);
                    });
                }
            });
        }

        updateElement(id, property, value) {
            const element = this.state.decorativeElements.front.find(el => el.id === id);
            if (element) {
                element[property] = property === 'size' || property === 'x' || property === 'y' ? parseInt(value) : value;
                this.applyDecorativeStyles();
            }
        }

        removeElement(id) {
            this.state.decorativeElements.front = this.state.decorativeElements.front.filter(el => el.id !== id);
            this.renderElementsControls();
            this.applyDecorativeStyles();
            this.showNotification('Elemen berhasil dihapus!');
        }

        addNewElement() {
            const newElement = {
                id: this.state.nextId++,
                visible: true,
                shape: 'circle',
                size: 50,
                x: 200,
                y: 300,
                color: `linear-gradient(135deg, ${this.getRandomColor()} 0%, ${this.getRandomColor()} 100%)`
            };
            
            this.state.decorativeElements.front.push(newElement);
            this.renderElementsControls();
            this.applyDecorativeStyles();
            this.showNotification('Elemen baru berhasil ditambahkan');
        }

        getRandomColor() {
            const colors = ['#667eea', '#764ba2', '#f093fb', '#f5576c', '#4facfe', '#00f2fe', '#43e97b', '#38f9d7', '#fa709a', '#fee140', '#30cfd0', '#330867'];
            return colors[Math.floor(Math.random() * colors.length)];
        }

        updateTemplate() {
            const selectedTemplate = document.querySelector('input[name="cardTemplate"]:checked').value;
            this.state.template = selectedTemplate;
            
            if (selectedTemplate === 'decorative') {
                this.elements.decorativeSection.style.display = 'block';
            } else {
                this.elements.decorativeSection.style.display = 'none';
            }
            
            this.updateCard();
        }

        handleInputChange(e) {
            if (e.target.classList.contains('input-field')) {
                if (e.target.id === 'frontBgColorInput') {
                    this.state.frontBackground = { type: 'color', value: e.target.value };
                } else if (e.target.id === 'backBgColorInput') {
                    this.state.backBackground = { type: 'color', value: e.target.value };
                } else if (e.target.id === 'sideBarColorInput') {
                    this.state.sideBarColor = e.target.value;
                    this.applySideBarColor(this.state.sideBarColor);
                }
                this.updateCard();
            }
        }

        applyDecorativeStyles() {
            // Clear existing elements
            this.elements.decorativeCirclesFront.innerHTML = '';
            this.elements.decorativeCirclesBack.innerHTML = '';
            
            // Apply front elements
            this.state.decorativeElements.front.forEach(element => {
                if (element.visible) {
                    const el = this.createElementDOM(element);
                    this.elements.decorativeCirclesFront.appendChild(el);
                }
            });
            
            // Apply back elements
            this.state.decorativeElements.back.forEach(element => {
                if (element.visible) {
                    const el = this.createElementDOM(element);
                    this.elements.decorativeCirclesBack.appendChild(el);
                }
            });
        }

        createElementDOM(element) {
            const el = document.createElement('div');
            el.className = `circle shape-${element.shape}`;
            el.style.width = `${element.size}px`;
            el.style.height = `${element.size}px`;
            el.style.left = `${element.x}px`;
            el.style.top = `${element.y}px`;
            el.style.right = 'auto';
            el.style.bottom = 'auto';
            el.style.background = element.color;
            el.style.position = 'absolute';
            el.style.opacity = '0.6';
            el.style.transition = 'all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1)';
            
            return el;
        }

        handleFontChange(e, elementType) {
            const selectedFont = e.target.value;
            
            if (selectedFont.startsWith('custom-')) {
                document.getElementById(`${elementType}FontUpload`).style.display = 'block';
            } else {
                document.getElementById(`${elementType}FontUpload`).style.display = 'none';
                this.state.fonts[elementType] = selectedFont;
                this.updateFontPreview(elementType, selectedFont);
                this.applyFontToCard(elementType, selectedFont);
            }
        }

        handleFontSizeChange(e, elementType) {
            const newSize = parseInt(e.target.value);
            this.state.fontSizes[elementType] = newSize;
            this.elements[`${elementType}FontSizeValue`].textContent = `${newSize}px`;
            this.updateFontPreview(elementType, this.state.fontSizes[elementType]);
            this.applyFontSizeToCard(elementType, newSize);
            this.adjustLayoutForFontSize(elementType, newSize);
        }

        adjustLayoutForFontSize(elementType, size) {
            if (elementType === 'company' && size > 24) {
                const cardHeader = document.querySelector('.card-header');
                const reduction = (size - 24) * 1;
                const newPadding = Math.max(5, 15 - reduction);
                cardHeader.style.padding = `${newPadding}px 20px`;
            } else if (elementType === 'company' && size <= 24) {
                const cardHeader = document.querySelector('.card-header');
                cardHeader.style.padding = '';
            }
            
            if (elementType === 'name' && size > 30) {
                const cardFooter = document.querySelector('.card-footer');
                const reduction = (size - 30) * 1;
                const newPadding = Math.max(5, 15 - reduction);
                cardFooter.style.padding = `${newPadding}px 20px`;
            } else if (elementType === 'name' && size <= 30) {
                const cardFooter = document.querySelector('.card-footer');
                cardFooter.style.padding = '';
            }
            
            if (elementType === 'other' && size > 18) {
                const backInfo = document.querySelector('.back-info');
                const reduction = (size - 18) * 1;
                const newGap = Math.max(5, 15 - reduction);
                backInfo.style.gap = `${newGap}px`;
            } else if (elementType === 'other' && size <= 18) {
                const backInfo = document.querySelector('.back-info');
                backInfo.style.gap = '';
            }
        }

        handleFontUpload(e, elementType) {
            const file = e.target.files[0];
            const label = document.getElementById(`${elementType}FontLabel`);
            const fileNameSpan = label.querySelector('.file-name');

            if (!file) {
                fileNameSpan.textContent = 'Pilih file font...';
                label.classList.remove('has-file');
                this.state.customFonts[elementType] = null;
                return;
            }

            if (!file.name.match(/\.(ttf|otf|woff|woff|woff2)$/i)) {
                this.showNotification('Harap pilih file font yang valid (.ttf, .otf, .woff, .woff2)!', 'error');
                e.target.value = '';
                return;
            }

            if (file.size > 5 * 1024 * 1024) {
                this.showNotification('Ukuran file maksimal 5MB!', 'error');
                e.target.value = '';
                return;
            }

            const reader = new FileReader();
            reader.onload = (event) => {
                const fontData = event.target.result;
                const fontName = `CustomFont_${elementType}_${Date.now()}`;
                
                const fontFace = new FontFace(fontName, `url(${fontData})`);
                
                fontFace.load().then(() => {
                    document.fonts.add(fontFace);
                    this.state.customFonts[elementType] = fontName;
                    this.state.fonts[elementType] = fontName;
                    this.updateFontPreview(elementType, fontName);
                    this.applyFontToCard(elementType, fontName);
                    fileNameSpan.textContent = file.name;
                    label.classList.add('has-file');
                    this.showNotification(`Font ${elementType} berhasil diupload!`);
                }).catch(error => {
                    console.error('Font loading error:', error);
                    this.showNotification('Gagal memuat font. Pastikan file font valid.', 'error');
                });
            };
            
            reader.readAsDataURL(file);
        }

        updateFontPreview(elementType, font) {
            const preview = document.getElementById(`${elementType}FontPreview`);
            preview.style.fontFamily = font;
            preview.style.fontSize = `${this.state.fontSizes[elementType]}px`;
            
            if (elementType === 'company') {
                preview.textContent = document.getElementById('companyInput').value || 'UPT SD NEGERI 067953';
            } else if (elementType === 'name') {
                preview.textContent = document.getElementById('nameInput').value || 'SUGANDI,S.Kom';
            } else if (elementType === 'other') {
                preview.textContent = document.getElementById('nipInput').value ? `NIP: ${document.getElementById('nipInput').value}` : 'NIP: 1234567890';
            }
        }

        applyFontToCard(elementType, font) {
            if (elementType === 'company') {
                this.elements.companyName.style.fontFamily = font;
                this.elements.backTitle.style.fontFamily = font;
            } else if (elementType === 'name') {
                this.elements.nameText.style.fontFamily = font;
                this.elements.backNameDisplay.style.fontFamily = font;
            } else if (elementType === 'other') {
                this.elements.nipText.style.fontFamily = font;
                this.elements.backNipDisplay.style.fontFamily = font;
                this.elements.backEmailDisplay.style.fontFamily = font;
                this.elements.backPhoneDisplay.style.fontFamily = font;
                this.elements.backPositionDisplay.style.fontFamily = font;
                this.elements.backOfficeDisplay.style.fontFamily = font;
                this.elements.deptTextLeft.style.fontFamily = font;
                this.elements.deptTextRight.style.fontFamily = font;
            }
        }

        applyFontSizeToCard(elementType, size) {
            if (elementType === 'company') {
                this.elements.companyName.style.fontSize = `${size}px`;
                this.elements.backTitle.style.fontSize = `${size}px`;
            } else if (elementType === 'name') {
                this.elements.nameText.style.fontSize = `${size}px`;
                this.elements.backNameDisplay.style.fontSize = `${size}px`;
            } else if (elementType === 'other') {
                this.elements.nipText.style.fontSize = `${size}px`;
                this.elements.backNipDisplay.style.fontSize = `${size}px`;
                this.elements.backEmailDisplay.style.fontSize = `${size}px`;
                this.elements.backPhoneDisplay.style.fontSize = `${size}px`;
                this.elements.backPositionDisplay.style.fontSize = `${size}px`;
                this.elements.backOfficeDisplay.style.fontSize = `${size}px`;
                this.elements.deptTextLeft.style.fontSize = `${size}px`;
                this.elements.deptTextRight.style.fontSize = `${size}px`;
            }
        }

        applySideBarColor(color) {
            const gradient = `linear-gradient(135deg, ${color} 0%, ${this.adjustColor(color, -20)} 100%)`;
            this.elements.greenSideLeft.style.background = gradient;
            this.elements.greenSideRight.style.background = gradient;
        }

        handleFileUpload(e, type) {
            const file = e.target.files[0];
            let label, fileNameSpan;

            switch(type) {
                case 'logo':
                    label = document.getElementById('logoLabel');
                    fileNameSpan = label.querySelector('.file-name');
                    break;
                case 'photo':
                    label = document.getElementById('photoLabel');
                    fileNameSpan = label.querySelector('.file-name');
                    break;
                case 'frontBg':
                    label = document.getElementById('frontBgLabel');
                    fileNameSpan = label.querySelector('.file-name');
                    break;
                case 'backBg':
                    label = document.getElementById('backBgLabel');
                    fileNameSpan = label.querySelector('.file-name');
                    break;
            }

            if (!file) {
                fileNameSpan.textContent = `Pilih file ${type}...`;
                label.classList.remove('has-file');
                if (type === 'logo') this.state.logoUrl = null;
                if (type === 'photo') this.state.photoUrl = null;
                if (type === 'frontBg') this.state.frontBackground = { type: 'color', value: this.elements.frontBgColorInput.value };
                if (type === 'backBg') this.state.backBackground = { type: 'color', value: this.elements.backBgColorInput.value };
                this.updateCard();
                return;
            }

            if (!file.type.startsWith('image/')) {
                this.showNotification('Harap pilih file gambar!', 'error');
                e.target.value = '';
                return;
            }

            if (file.size > 5 * 1024 * 1024) {
                this.showNotification('Ukuran file maksimal 5MB!', 'error');
                e.target.value = '';
                return;
            }

            const reader = new FileReader();
            reader.onload = (event) => {
                const url = event.target.result;
                if (type === 'logo') {
                    this.state.logoUrl = url;
                    this.displayLogo(url);
                } else if (type === 'photo') {
                    this.state.photoUrl = url;
                    this.displayPhoto(url);
                } else if (type === 'frontBg') {
                    this.state.frontBackground = { type: 'image', value: url };
                } else if (type === 'backBg') {
                    this.state.backBackground = { type: 'image', value: url };
                }
                fileNameSpan.textContent = file.name;
                label.classList.add('has-file');
                this.showNotification(`Background ${type === 'frontBg' ? 'depan' : 'belakang'} berhasil diupload!`);
                this.updateCard();
            };
            reader.readAsDataURL(file);
        }

        toggleBackgroundOption(side) {
            const type = document.querySelector(`input[name="${side}BgType"]:checked`).value;
            const colorContent = document.getElementById(`${side}BgColorContent`);
            const imageContent = document.getElementById(`${side}BgImageContent`);

            if (type === 'color') {
                colorContent.classList.add('active');
                imageContent.classList.remove('active');
                if (side === 'front') {
                    this.state.frontBackground = { type: 'color', value: this.elements.frontBgColorInput.value };
                } else {
                    this.state.backBackground = { type: 'color', value: this.elements.backBgColorInput.value };
                }
            } else {
                colorContent.classList.remove('active');
                imageContent.classList.add('active');
            }
            this.updateCard();
        }

        displayLogo(url) {
            this.elements.logoImage.style.display = url ? 'block' : 'none';
            this.elements.logoPlaceholder.style.display = url ? 'none' : 'block';
            if (url) this.elements.logoImage.src = url;
        }

        displayPhoto(url) {
            this.elements.personImg.src = url || 'https://picsum.photos/seed/person-placeholder/300/350.jpg';
        }

        updateCard() {
            const data = this.getFormData();
            
            // Update Template Classes
            this.elements.cardFront.className = `card-face card-front card-front-${this.state.template}`;
            this.elements.cardBack.className = `card-face card-back`;
            
            // Update Backgrounds
            if (this.state.frontBackground.type === 'image') {
                this.elements.cardFront.style.backgroundImage = `url(${this.state.frontBackground.value})`;
                this.elements.cardFront.style.backgroundSize = 'cover';
                this.elements.cardFront.style.backgroundPosition = 'center';
            } else {
                this.elements.cardFront.style.backgroundImage = 'none';
                if (this.state.template === 'plain') {
                    this.elements.cardFront.style.backgroundColor = this.state.frontBackground.value;
                } else {
                    this.elements.cardFront.style.background = 'var(--light-gradient)';
                }
            }

            if (this.state.backBackground.type === 'image') {
                this.elements.cardBack.style.backgroundImage = `url(${this.state.backBackground.value})`;
                this.elements.cardBack.style.backgroundSize = 'cover';
                this.elements.cardBack.style.backgroundPosition = 'center';
            } else {
                this.elements.cardBack.style.backgroundImage = 'none';
                this.elements.cardBack.style.backgroundColor = this.state.backBackground.value;
            }
            
            // Show/hide decorative elements based on template (hanya untuk depan)
            if (this.state.template === 'plain') {
                this.elements.greenSideLeft.style.display = 'none';
                this.elements.greenSideRight.style.display = 'none';
                this.elements.decorativeCirclesFront.style.display = 'none';
                this.elements.decorativeCirclesBack.style.display = 'none';
            } else {
                this.applyDecorativeStyles();
                this.elements.greenSideLeft.style.display = 'flex';
                this.elements.greenSideRight.style.display = 'flex';
                this.elements.decorativeCirclesFront.style.display = 'block';
                // Pastikan dekoratif belakang tidak ditampilkan
                this.elements.decorativeCirclesBack.style.display = 'none';
            }
            
            // Update Front Card
            this.elements.companyName.textContent = data.company;
            this.elements.nameText.textContent = data.name;
            
            // Perbarui bagian jabatan - hanya teks yang disembunyikan
            if (this.state.showPosition) {
                this.elements.deptTextLeft.textContent = data.position;
                this.elements.deptTextRight.textContent = data.position;
                this.elements.deptTextLeft.style.display = 'block';
                this.elements.deptTextRight.style.display = 'block';
            } else {
                this.elements.deptTextLeft.textContent = '';
                this.elements.deptTextRight.textContent = '';
                this.elements.deptTextLeft.style.display = 'none';
                this.elements.deptTextRight.style.display = 'none';
            }
            
            // Handle NIP display
            if (data.nip) {
                this.elements.nipText.textContent = `NIP: ${data.nip}`;
                this.elements.nipText.classList.add('show');
            } else {
                this.elements.nipText.classList.remove('show');
            }

            // Update Back Card
            this.elements.backNameDisplay.textContent = data.name;
            this.elements.backNipDisplay.textContent = data.nip ? `NIP ${data.nip}` : '';
            this.elements.backNipDisplay.style.display = data.nip ? 'block' : 'none';
            this.elements.backEmailDisplay.textContent = data.email;
            this.elements.backPhoneDisplay.textContent = data.phone.replace(/-/g, ' - ');
            this.elements.backPositionDisplay.textContent = data.position;
            this.elements.backOfficeDisplay.textContent = data.office;

            // Update Footer Color (only for decorative template)
            if (this.state.template === 'decorative') {
                const footer = document.querySelector('.card-footer');
                footer.style.background = `linear-gradient(135deg, ${data.headerColor} 0%, ${this.adjustColor(data.headerColor, 20)} 100%)`;
            } else {
                const footer = document.querySelector('.card-footer');
                footer.style.background = '';
            }
            
            // Apply fonts and sizes
            this.applyFontToCard('company', this.state.fonts.company);
            this.applyFontToCard('name', this.state.fonts.name);
            this.applyFontToCard('other', this.state.fonts.other);

            this.applyFontSizeToCard('company', this.state.fontSizes.company);
            this.applyFontSizeToCard('name', this.state.fontSizes.name);
            this.applyFontSizeToCard('other', this.state.fontSizes.other);
            
            // Apply layout adjustments for current font sizes
            this.adjustLayoutForFontSize('company', this.state.fontSizes.company);
            this.adjustLayoutForFontSize('name', this.state.fontSizes.name);
            this.adjustLayoutForFontSize('other', this.state.fontSizes.other);
            
            // Apply side bar color for decorative template
            if (this.state.template === 'decorative') {
                this.applySideBarColor(this.state.sideBarColor);
            }
            
            // Generate QR Code
            this.generateQRCode(data);
        }

        getFormData() {
            return {
                company: document.getElementById('companyInput').value,
                name: document.getElementById('nameInput').value,
                nip: document.getElementById('nipInput').value,
                position: document.getElementById('positionInput').value,
                email: document.getElementById('emailInput').value,
                phone: document.getElementById('phoneInput').value,
                office: document.getElementById('officeInput').value,
                headerColor: document.getElementById('headerColorInput').value,
            };
        }

        generateQRCode(data) {
            const vcardData = `${data.name}\n${data.nip}\n${data.company}\n${data.position}\n${data.phone}\n${data.email}\n${data.office}\n`;
            
            this.elements.qrcode.innerHTML = '';
            new QRCode(this.elements.qrcode, {
                text: vcardData,
                width: 170,
                height: 170,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });
        }

        flipCard() {
            this.state.isFlipped = !this.state.isFlipped;
            this.elements.cardFlipper.classList.toggle('flipped');
            this.elements.flipIndicator.textContent = this.state.isFlipped ? 'Belakang' : 'Depan';
        }

        resetCard() {
            this.elements.form.reset();
            this.state.logoUrl = null;
            this.state.photoUrl = null;
            this.state.template = 'decorative';
            this.state.frontBackground = { type: 'color', value: '#f5f7fa' };
            this.state.backBackground = { type: 'color', value: '#667eea' };
            this.state.fonts = {
                company: "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif",
                name: "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif",
                other: "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif"
            };
            this.state.fontSizes = {
                company: 18,
                name: 24,
                other: 16
            };
            this.state.customFonts = {
                company: null,
                name: null,
                other: null
            };
            this.state.sideBarColor = '#11998e';
            this.state.showPosition = true; // Reset toggle jabatan
            
            // Reset decorative elements
            this.state.decorativeElements = {
                front: [
                    {
                        id: 1,
                        visible: true,
                        shape: 'circle',
                        size: 80,
                        x: 20,
                        y: 20,
                        color: 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)'
                    },
                    {
                        id: 2,
                        visible: true,
                        shape: 'circle',
                        size: 60,
                        x: 320,
                        y: 450,
                        color: 'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)'
                    },
                    {
                        id: 3,
                        visible: true,
                        shape: 'circle',
                        size: 40,
                        x: 350,
                        y: 20,
                        color: 'linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%)'
                    }
                ],
                back: []
            };
            this.state.nextId = 4;
            
            // Reset UI
            this.displayLogo(null);
            this.displayPhoto(null);
            document.getElementById('logoLabel').querySelector('.file-name').textContent = 'Pilih file logo...';
            document.getElementById('photoLabel').querySelector('.file-name').textContent = 'Pilih foto person...';
            document.getElementById('frontBgLabel').querySelector('.file-name').textContent = 'Pilih gambar...';
            document.getElementById('backBgLabel').querySelector('.file-name').textContent = 'Pilih gambar...';
            document.querySelectorAll('.file-upload-label').forEach(label => label.classList.remove('has-file'));
            
            // Reset font UI
            document.getElementById('companyFontLabel').querySelector('.file-name').textContent = 'Pilih file font...';
            document.getElementById('nameFontLabel').querySelector('.file-name').textContent = 'Pilih file font...';
            document.getElementById('otherFontLabel').querySelector('.file-name').textContent = 'Pilih file font...';
            document.querySelectorAll('#companyFontLabel, #nameFontLabel, #otherFontLabel').forEach(label => label.classList.remove('has-file'));
            document.getElementById('companyFontUpload').style.display = 'none';
            document.getElementById('nameFontUpload').style.display = 'none';
            document.getElementById('otherFontUpload').style.display = 'none';

            // Reset font size UI
            this.elements.companyFontSizeInput.value = 18;
            this.elements.nameFontSizeInput.value = 24;
            this.elements.otherFontSizeInput.value = 16;
            this.elements.companyFontSizeValue.textContent = '18px';
            this.elements.nameFontSizeValue.textContent = '24px';
            this.elements.otherFontSizeValue.textContent = '16px';
            
            // Reset toggle jabatan
            if (this.elements.showPositionToggle) {
                this.elements.showPositionToggle.checked = true;
            }
            
            // Reset layout adjustments
            document.querySelector('.card-header').style.padding = '';
            document.querySelector('.card-footer').style.padding = '';
            document.querySelector('.back-info').style.gap = '';
            
            // Reset background controls
            document.querySelector('input[name="frontBgType"][value="color"]').checked = true;
            document.querySelector('input[name="backBgType"][value="color"]').checked = true;
            this.toggleBackgroundOption('front');
            this.toggleBackgroundOption('back');

            // Reset template control
            document.querySelector('input[name="cardTemplate"][value="decorative"]').checked = true;
            this.updateTemplateSelection('decorative');
            this.elements.decorativeSection.style.display = 'block';
            
            // Re-render elements controls
            this.renderElementsControls();
            
            this.updateCard();
            this.showNotification('Kartu direset ke default');
        }

        // ============================================
        // EXPORT/IMPORT SETTINGS
        // ============================================
        exportSettings() {
    try {
        // Validasi elemen yang diperlukan
        const companyInput = document.getElementById('companyInput');
        const nameInput = document.getElementById('nameInput');
        const nipInput = document.getElementById('nipInput');
        // const positionInput = const positionInput = document.getElementById('positionInput');
        const emailInput = document.getElementById('emailInput');
        const phoneInput = document.getElementById('phoneInput');
        const officeInput = document.getElementById('officeInput');
        const headerColorInput = document.getElementById('headerColorInput');
        const sideBarColorInput = document.getElementById('sideBarColorInput');
        
        // Validasi minimal
        if (!companyInput || !nameInput) {
            throw new Error('Nama perusahaan dan nama harus diisi!');
        }
        
        const settings = {
            // Basic Info
            company: companyInput.value,
            name: nameInput.value,
            nip: nipInput.value,
            position: positionInput.value,
            email: emailInput.value,
            phone: phoneInput.value,
            office: officeInput.value,
            
            // Template & Design
            template: this.state.template,
            showPosition: this.state.showPosition,
            headerColor: headerColorInput.value,
            sideBarColor: sideBarColorInput.value,
            
            // Background Settings
            frontBackground: this.state.frontBackground,
            backBackground: this.state.backBackground,
            
            // Font Settings
            fonts: this.state.fonts,
            fontSizes: this.state.fontSizes,
            
            // Decorative Elements
            decorativeElements: this.state.decorativeElements,
            
            // Images (base64)
            logoUrl: this.state.logoUrl,
            photoUrl: this.state.photoUrl,
            
            // Metadata
            exportDate: new Date().toISOString(),
            version: '1.0'
        };
        
        // Konversi ke JSON string
        const settingsJson = JSON.stringify(settings, null, 2);
        
        // Buat blob dan download
        const blob = new Blob([settingsJson], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        
        const a = document.createElement('a');
        a.href = url;
        
        // Generate nama file yang lebih aman
        const fileName = this._generateFileName('front');
        a.download = `kartu_setting_${fileName.replace('.png', '')}.json`;
        
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        
        URL.revokeObjectURL(url);
        
        this.showNotification('✅ Setting berhasil diexport!');
        
    } catch (error) {
        console.error('Export error:', error);
        this.showNotification('❌ Gagal export setting: ' + error.message, 'error');
    }
}

        importSettings(event) {
    const file = event.target.files[0];
    
    if (!file) return;
    
    if (!file.name.endsWith('.json')) {
        this.showNotification('❌ Harap pilih file JSON yang valid!', 'error');
        event.target.value = '';
        return;
    }
    
    // Validasi ukuran file (maks 5MB)
    if (file.size > 5 * 1024 * 1024) {
        this.showNotification('❌ Ukuran file maksimal 5MB!', 'error');
        event.target.value = '';
        return;
    }
    
    const reader = new FileReader();
    
    reader.onload = (e) => {
        try {
            const settings = JSON.parse(e.target.result);
            
            // Validasi minimal
            if (!settings.version) {
                throw new Error('File setting tidak valid atau korup');
            }
            
            // Validasi versi
            if (settings.version !== '1.0') {
                throw new Error('Versi file tidak kompatibel');
            }
            
            // Validasi field wajib
            if (!settings.name || !settings.company) {
                throw new Error('File setting tidak lengkap (nama dan perusahaan harus ada)');
            }
            
            // Terapkan setting
            this.applySettings(settings);
            
            this.showNotification('✅ Setting berhasil diimport!');
            
        } catch (error) {
            console.error('Import error:', error);
            this.showNotification('❌ Gagal import setting: ' + error.message, 'error');
        }
        
        event.target.value = '';
    };
    
    reader.onerror = () => {
        this.showNotification('❌ Gagal membaca file', 'error');
        event.target.value = '';
    };
    
    reader.readAsText(file);
}

        applySettings(settings) {
    // Tampilkan loading
    this.showLoading('Menerapkan setting...', false);
    
    try {
        // Validasi minimal
        if (!settings.name || !settings.company) {
            throw new Error('Data setting tidak lengkap');
        }
        
        // Apply Basic Info
        if (settings.company) {
            const companyInput = document.getElementById('companyInput');
            if (companyInput) companyInput.value = settings.company;
        }
        
        if (settings.name) {
            const nameInput = document.getElementById('nameInput');
            if (nameInput) nameInput.value = settings.name;
        }
        
        if (settings.nip) {
            const nipInput = document.getElementById('nipInput');
            if (nipInput) nipInput.value = settings.nip;
        }
        
        if (settings.position) {
            const positionInput = document.getElementById('positionInput');
            if (positionInput) positionInput.value = settings.position;
        }
        
        if (settings.email) {
            const emailInput = document.getElementById('emailInput');
            if (emailInput) emailInput.value = settings.email;
        }
        
        if (settings.phone) {
            const phoneInput = document.getElementById('phoneInput');
            if (phoneInput) phoneInput.value = settings.phone;
        }
        
        if (settings.office) {
            const officeInput = document.getElementById('officeInput');
            if (officeInput) officeInput.value = settings.office;
        }
        
        // Apply Template & Design
        if (settings.template) {
            this.state.template = settings.template;
            const templateRadio = document.querySelector(`input[name="cardTemplate"][value="${settings.template}"]`);
            if (templateRadio) {
                templateRadio.checked = true;
                this.updateTemplateSelection(settings.template);
            }
            
            // Show/hide decorative section
            if (settings.template === 'decorative') {
                if (this.elements.decorativeSection) {
                    this.elements.decorativeSection.style.display = 'block';
                }
            } else {
                if (this.elements.decorativeSection) {
                    this.elements.decorativeSection.style.display = 'none';
                }
            }
        }
        
        if (settings.showPosition !== undefined) {
            this.state.showPosition = settings.showPosition;
            const showPositionToggle = document.getElementById('showPositionToggle');
            if (showPositionToggle) {
                showPositionToggle.checked = settings.showPosition;
            }
        }
        
        if (settings.headerColor) {
            const headerColorInput = document.getElementById('headerColorInput');
            if (headerColorInput) headerColorInput.value = settings.headerColor;
        }
        
        if (settings.sideBarColor) {
            this.state.sideBarColor = settings.sideBarColor;
            const sideBarColorInput = document.getElementById('sideBarColorInput');
            if (sideBarColorInput) sideBarColorInput.value = settings.sideBarColor;
        }
        
        // Apply Background Settings
        if (settings.frontBackground) {
            this.state.frontBackground = settings.frontBackground;
            const frontBgColorRadio = document.querySelector('input[name="frontBgType"][value="color"]');
            const frontBgImageRadio = document.querySelector('input[name="frontBgType"][value="image"]');
            
            if (settings.frontBackground.type === 'color' && frontBgColorRadio) {
                frontBgColorRadio.checked = true;
                if (this.elements.frontBgColorInput) {
                    this.elements.frontBgColorInput.value = settings.frontBackground.value;
                }
            } else if (settings.frontBackground.type === 'image' && frontBgImageRadio) {
                frontBgImageRadio.checked = true;
            }
            this.toggleBackgroundOption('front');
        }
        
        if (settings.backBackground) {
            this.state.backBackground = settings.backBackground;
            const backBgColorRadio = document.querySelector('input[name="backBgType"][value="color"]');
            const backBgImageRadio = document.querySelector('input[name="backBgType"][value="image"]');
            
            if (settings.backBackground.type === 'color' && backBgColorRadio) {
                backBgColorRadio.checked = true;
                if (this.elements.backBgColorInput) {
                    this.elements.backBgColorInput.value = settings.backBackground.value;
                }
            } else if (settings.backBackground.type === 'image' && backBgImageRadio) {
                backBgImageRadio.checked = true;
            }
            this.toggleBackgroundOption('back');
        }
        
        // Apply Font Settings
        if (settings.fonts) {
            this.state.fonts = settings.fonts;
            
            // Update font selectors
            if (settings.fonts.company) {
                const companyFontSelect = document.getElementById('companyFontSelect');
                if (companyFontSelect) {
                    companyFontSelect.value = settings.fonts.company;
                    this.applyFontToCard('company', settings.fonts.company);
                }
            }
            if (settings.fonts.name) {
                const nameFontSelect = document.getElementById('nameFontSelect');
                if (nameFontSelect) {
                    nameFontSelect.value = settings.fonts.name;
                    this.applyFontToCard('name', settings.fonts.name);
                }
            }
            if (settings.fonts.other) {
                const otherFontSelect = document.getElementById('otherFontSelect');
                if (otherFontSelect) {
                    otherFontSelect.value = settings.fonts.other;
                    this.applyFontToCard('other', settings.fonts.other);
                }
            }
        }
        
        if (settings.fontSizes) {
            this.state.fontSizes = settings.fontSizes;
            
            // Update font size sliders
            if (settings.fontSizes.company) {
                const companyFontSizeInput = document.getElementById('companyFontSizeInput');
                if (companyFontSizeInput) {
                    companyFontSizeInput.value = settings.fontSizes.company;
                    this.elements.companyFontSizeValue.textContent = `${settings.fontSizes.company}px`;
                    this.applyFontSizeToCard('company', settings.fontSizes.company);
                }
            }
            if (settings.fontSizes.name) {
                const nameFontSizeInput = document.getElementById('nameFontSizeInput');
                if (nameFontSizeInput) {
                    nameFontSizeInput.value = settings.fontSizes.name;
                    this.elements.nameFontSizeValue.textContent = `${settings.fontSizes.name}px`;
                    this.applyFontSizeToCard('name', settings.fontSizes.name);
                }
            }
            if (settings.fontSizes.other) {
                const otherFontSizeInput = document.getElementById('otherFontSizeInput');
                if (otherFontSizeInput) {
                    otherFontSizeInput.value = settings.fontSizes.other;
                    this.elements.otherFontSizeValue.textContent = `${settings.fontSizes.other}px`;
                    this.applyFontSizeToCard('other', settings.fontSizes.other);
                }
            }
        }
        
        // Apply Decorative Elements
        if (settings.decorativeElements && settings.decorativeElements.front) {
            this.state.decorativeElements = settings.decorativeElements;
            
            // Update nextId
            const maxId = Math.max(...settings.decorativeElements.front.map(el => el.id));
            this.state.nextId = maxId + 1;
            
            // Re-render elements controls
            this.renderElementsControls();
        }
        
        // Apply images if available (base64)
        if (settings.logoUrl) {
            this.state.logoUrl = settings.logoUrl;
            this.displayLogo(settings.logoUrl);
        }
        
        if (settings.photoUrl) {
            this.state.photoUrl = settings.photoUrl;
            this.displayPhoto(settings.photoUrl);
        }
        
        // Update card dengan semua setting baru
        this.updateCard();
        
        setTimeout(() => {
            this.hideLoading();
        }, 500);
        
    } catch (error) {
        console.error('Apply settings error:', error);
        this.hideLoading();
        this.showNotification('❌ Gagal menerapkan setting: ' + error.message, 'error');
    }
}

        // ============================================
        // DOWNLOAD & CANVAS LOGIC
        // ============================================
        async downloadCard(side) {
            const sideText = side === 'front' ? 'Depan' : side === 'back' ? 'Belakang' : 'Kedua Sisi';
            this.showLoading(`Mengunduh sisi ${sideText}...`, true);
            this.updateProgress(5);

            try {
                let canvas;
                
                if (side === 'both') {
                    canvas = await this._downloadBothSides();
                } else {
                    canvas = await this._downloadSingleSide(side);
                }
                
                this.updateProgress(80);
                this._triggerDownload(canvas, this._generateFileName(side));
                this.updateProgress(100);

                setTimeout(() => {
                    this.hideLoading();
                    this.showNotification(`✅ Sisi ${sideText} berhasil diunduh!`);
                }, 300);

            } catch (error) {
                console.error('Download error:', error);
                this.hideLoading();
                this.showNotification(`❌ Gagal mengunduh: ${error.message}`, 'error');
            }
        }

        async _downloadSingleSide(side) {
            // Simpan state asli
            const originalState = this.state.isFlipped;
            
            // Pastikan sisi yang benar ditampilkan
            if ((side === 'front' && this.state.isFlipped) || 
                (side === 'back' && !this.state.isFlipped)) {
                this.flipCard();
            }
            
            // Tunggu animasi selesai
            await new Promise(resolve => setTimeout(resolve, 300));
            
            // Dapatkan elemen asli
            const originalSide = document.getElementById(`card${side.charAt(0).toUpperCase() + side.slice(1)}`);
            
            if (!originalSide) {
                throw new Error(`Elemen card${side.charAt(0).toUpperCase() + side.slice(1)} tidak ditemukan`);
            }
            
            // Buat container sementara
            const tempContainer = document.createElement('div');
            tempContainer.style.cssText = `
                position: absolute;
                left: -9999px;
                top: 0;
                width: 400px;
                height: 600px;
                background: #ffffff;
                border-radius: 20px;
                box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                overflow: hidden;
            `;
            
            // Clone sisi yang dimaksud
            const clone = originalSide.cloneNode(true);
            
            // Terapkan semua perbaikan
            this._fixClonedCard(clone, side);
            
            tempContainer.appendChild(clone);
            document.body.appendChild(tempContainer);
            this.updateProgress(30);

            // Tunggu rendering
            await new Promise(resolve => setTimeout(resolve, 500));
            
            const canvas = await html2canvas(tempContainer, {
                scale: 2,
                useCORS: true,
                allowTaint: true,
                backgroundColor: '#ffffff',
                logging: false,
                width: 400,
                height: 600,
            });

            document.body.removeChild(tempContainer);
            
            // Kembalikan state asli
            if (originalState !== this.state.isFlipped) {
                this.flipCard();
            }
            
            return canvas;
        }

        async _downloadBothSides() {
            // Buat dua canvas terpisah untuk masing-masing sisi
            const frontCanvas = await this._createSideCanvas('front');
            const backCanvas = await this._createSideCanvas('back');
            
            this.updateProgress(50);
            
            // Buat canvas gabungan
            const combinedCanvas = document.createElement('canvas');
            const ctx = combinedCanvas.getContext('2d');
            
            // Set ukuran canvas gabungan (400px + 40px gap + 400px = 840px, 600px tinggi)
            combinedCanvas.width = 840 * 2; // Scale 2x
            combinedCanvas.height = 600 * 2; // Scale 2x
            
            // Gambar background putih
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, combinedCanvas.width, combinedCanvas.height);
            
            // Gambar canvas depan di posisi kiri
            ctx.drawImage(frontCanvas, 0, 0);
            
            // Gambar canvas belakang di posisi kanan (dengan gap 40px)
            ctx.drawImage(backCanvas, 440 * 2, 0); // 400px + 40px gap = 440px
            
            return combinedCanvas;
        }

        async _createSideCanvas(side) {
            // Simpan state asli
            const originalState = this.state.isFlipped;
            
            // Pastikan sisi yang benar ditampilkan
            if ((side === 'front' && this.state.isFlipped) || 
                (side === 'back' && !this.state.isFlipped)) {
                this.flipCard();
            }
            
            // Tunggu animasi selesai
            await new Promise(resolve => setTimeout(resolve, 100));
            
            // Clone sisi yang dimaksud
            const originalSide = document.getElementById(`card${side.charAt(0).toUpperCase() + side.slice(1)}`);
            const clone = this._cloneCardSideForDownload(originalSide);
            
            // Buat container sementara
            const tempContainer = document.createElement('div');
            tempContainer.style.position = 'absolute';
            tempContainer.style.left = '-9999px';
            tempContainer.style.top = '0';
            tempContainer.style.width = '400px';
            tempContainer.style.height = '600px';
            tempContainer.style.background = '#ffffff';
            tempContainer.appendChild(clone);
            
            document.body.appendChild(tempContainer);
            
            // Buat canvas dari container
            const canvas = await html2canvas(tempContainer, {
                scale: 2,
                useCORS: true,
                allowTaint: true,
                backgroundColor: '#ffffff',
                logging: false,
                width: 400,
                height: 600,
            });
            
            document.body.removeChild(tempContainer);
            
            // Kembalikan state asli
            if (originalState !== this.state.isFlipped) {
                this.flipCard();
            }
            
            return canvas;
        }

        _cloneCardSideForDownload(originalSide) {
            const clone = originalSide.cloneNode(true);
            
            // Reset transform
            clone.style.transform = 'none';
            clone.style.backfaceVisibility = 'visible';
            clone.style.position = 'relative';
            clone.style.width = '400px';
            clone.style.height = '600px';
            clone.style.overflow = 'hidden';
            clone.style.margin = '0';
            clone.style.boxSizing = 'border-box';
            clone.style.display = 'flex';
            clone.style.flexDirection = 'column';
            
            // Perbaiki semua elemen
            this._fixAllElementsForDownload(clone);
            
            return clone;
        }

        _fixClonedCard(clone, side) {
            // Reset transform dan properti dasar
            clone.style.cssText = `
                transform: none;
                backface-visibility: visible;
                position: relative;
                width: 400px;
                height: 600px;
                overflow: hidden;
                margin: 0;
                box-sizing: border-box;
                display: flex;
                flex-direction: column;
                border-radius: 20px;
                box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            `;
            
            // Terapkan background
            this._applyBackgroundToClone(clone, side);
            
            // Perbaiki semua elemen
            if (side === 'front') {
                this._fixFrontCardElements(clone);
                // Hanya tambahkan dekoratif untuk bagian depan
                if (this.state.template === 'decorative') {
                    this._fixDecorativeElementsForDownload(clone);
                    this._fixGreenSideBarsForDownload(clone);
                }
            } else {
                this._fixBackCardElements(clone);
                // JANGAN tambahkan dekoratif untuk bagian belakang
            }
        }

        _applyBackgroundToClone(clone, side) {
            if (side === 'front') {
                if (this.state.frontBackground.type === 'image') {
                    clone.style.backgroundImage = `url(${this.state.frontBackground.value})`;
                    clone.style.backgroundSize = 'cover';
                    clone.style.backgroundPosition = 'center';
                } else {
                    clone.style.backgroundImage = 'none';
                    if (this.state.template === 'plain') {
                        clone.style.backgroundColor = this.state.frontBackground.value;
                    } else {
                        clone.style.background = 'var(--light-gradient)';
                    }
                }
            } else {
                if (this.state.backBackground.type === 'image') {
                    clone.style.backgroundImage = `url(${this.state.backBackground.value})`;
                    clone.style.backgroundSize = 'cover';
                    clone.style.backgroundPosition = 'center';
                } else {
                    clone.style.backgroundImage = 'none';
                    clone.style.backgroundColor = this.state.backBackground.value;
                }
            }
        }

        _fixFrontCardElements(clone) {
            // Header
            const header = clone.querySelector('.card-header');
            if (header) {
                header.style.cssText = `
                    flex-shrink: 0;
                    padding: 15px;
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    gap: 10px;
                    position: relative;
                    z-index: 2;
                `;
            }
            
            // Logo container
            const logoContainer = clone.querySelector('.logo-container');
            if (logoContainer) {
                logoContainer.style.cssText = `
                    width: 60px;
                    height: 60px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    border-radius: 10px;
                    overflow: hidden;
                    background: rgba(255,255,255,0.9);
                    border: 2px solid rgba(255,255,255,0.5);
                `;
            }
            
            // Logo image
            const logoImage = clone.querySelector('.logo-image');
            if (logoImage && this.state.logoUrl) {
                logoImage.src = this.state.logoUrl;
                logoImage.style.cssText = `
                    max-width: 100%;
                    max-height: 100%;
                    object-fit: contain;
                    display: block;
                `;
            }
            
            // Company name
            const companyName = clone.querySelector('.company-name');
            if (companyName) {
                companyName.textContent = document.getElementById('companyInput').value;
                companyName.style.cssText = `
                    font-size: ${this.state.fontSizes.company}px;
                    font-weight: bold;
                    color: ${this.state.template === 'plain' ? 'white' : '#333'};
                    font-family: ${this.state.fonts.company};
                    text-shadow: ${this.state.template === 'plain' ? '2px 2px 8px rgba(0,0,0,0.7)' : 'none'};
                `;
            }
            
            // Card image container
            const cardImageContainer = clone.querySelector('.card-image-container');
            if (cardImageContainer) {
                cardImageContainer.style.cssText = `
                    flex: 1;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    padding: 10px;
                    position: relative;
                    min-height: 0;
                    z-index: 1;
                `;
            }
            
            // Person image
            const personImage = clone.querySelector('.person-image');
            if (personImage) {
                personImage.style.cssText = `
                    width: 300px;
                    height: 350px;
                    max-width: 100%;
                    max-height: 100%;
                    flex-shrink: 0;
                    border-radius: 15px;
                    box-shadow: 0 10px 20px rgba(0,0,0,0.2);
                    overflow: hidden;
                    position: relative;
                `;
                
                const personImg = personImage.querySelector('img');
                if (personImg) {
                    if (this.state.photoUrl) {
                        personImg.src = this.state.photoUrl;
                    }
                    personImg.style.cssText = `
                        width: 100%;
                        height: 100%;
                        object-fit: cover;
                        display: block;
                    `;
                }
            }
            
            // Footer
            const footer = clone.querySelector('.card-footer');
            if (footer) {
                footer.style.cssText = `
                    flex-shrink: 0;
                    padding: 15px;
                    text-align: center;
                    position: relative;
                    z-index: 2;
                    ${this.state.template === 'decorative' ? 
                        `background: linear-gradient(135deg, ${document.getElementById('headerColorInput').value} 0%, ${this.adjustColor(document.getElementById('headerColorInput').value, 20)} 100%);` : 
                        'background: transparent;'}
                `;
            }
            
            // Name text
            const nameText = clone.querySelector('.name-text');
            if (nameText) {
                nameText.textContent = document.getElementById('nameInput').value;
                nameText.style.cssText = `
                    font-size: ${this.state.fontSizes.name}px;
                    font-weight: bold;
                    color: ${this.state.template === 'plain' ? 'white' : '#333'};
                    font-family: ${this.state.fonts.name};
                    text-shadow: ${this.state.template === 'plain' ? '2px 2px 8px rgba(0,0,0,0.7)' : '2px 2px 4px rgba(0,0,0,0.2)'};
                `;
            }
            
            // NIP text
            const nipText = clone.querySelector('.nip-text');
            if (nipText) {
                const nipValue = document.getElementById('nipInput').value;
                if (nipValue) {
                    nipText.textContent = `NIP: ${nipValue}`;
                    nipText.style.display = 'block';
                } else {
                    nipText.style.display = 'none';
                }
                nipText.style.cssText = `
                    font-size: ${this.state.fontSizes.other}px;
                    margin-top: 5px;
                    color: ${this.state.template === 'plain' ? 'white' : '#333'};
                    font-family: ${this.state.fonts.other};
                    text-shadow: ${this.state.template === 'plain' ? '2px 2px 8px rgba(0,0,0,0.7)' : '1px 1px 2px rgba(0,0,0,0.2)'};
                `;
            }
            
            // Green side bars - selalu tampilkan, tapi sembunyikan teks jika perlu
            if (this.state.template === 'decorative') {
                this._fixGreenSideBarsForDownload(clone);
                
                // Sembunyikan teks jabatan jika toggle tidak aktif
                if (!this.state.showPosition) {
                    const deptTextLeft = clone.querySelector('.dept-text');
                    const deptTextRight = clone.querySelector('.dept-text');
                    
                    if (deptTextLeft) {
                        deptTextLeft.style.display = 'none';
                    }
                    
                    if (deptTextRight) {
                        deptTextRight.style.display = 'none';
                    }
                }
            }
        }

        _fixBackCardElements(clone) {
            // Hapus container dekoratif jika ada
            const decorativeContainer = clone.querySelector('.decorative-circles');
            if (decorativeContainer) {
                decorativeContainer.remove();
            }
            
            // Hapus green side bars jika ada
            const greenSideLeft = clone.querySelector('.green-side-left');
            const greenSideRight = clone.querySelector('.green-side-right');
            if (greenSideLeft) greenSideLeft.remove();
            if (greenSideRight) greenSideRight.remove();
            
            // Back title
            const backTitle = clone.querySelector('.back-title');
            if (backTitle) {
                backTitle.style.cssText = `
                    font-size: ${this.state.fontSizes.company}px;
                    font-weight: bold;
                    text-transform: uppercase;
                    letter-spacing: 2px;
                    text-align: center;
                    margin-bottom: 20px;
                    flex-shrink: 0;
                    color: white;
                    font-family: ${this.state.fonts.company};
                `;
            }
            
            // Back info
            const backInfo = clone.querySelector('.back-info');
            if (backInfo) {
                backInfo.style.cssText = `
                    flex: 1;
                    display: flex;
                    flex-direction: column;
                    justify-content: center;
                    gap: 15px;
                    margin-bottom: 20px;
                    overflow-y: auto;
                    min-height: 0;
                `;
            }
            
            // Update info items dengan data terbaru
            const backNameDisplay = clone.querySelector('#backNameDisplay');
            if (backNameDisplay) {
                backNameDisplay.textContent = document.getElementById('nameInput').value;
                backNameDisplay.style.cssText = `
                    font-size: ${this.state.fontSizes.name}px;
                    color: white;
                    font-family: ${this.state.fonts.name};
                `;
            }
            
            const backNipDisplay = clone.querySelector('#backNipDisplay');
            if (backNipDisplay) {
                const nipValue = document.getElementById('nipInput').value;
                backNipDisplay.textContent = nipValue ? `NIP ${nipValue}` : '';
                backNipDisplay.style.display = nipValue ? 'block' : 'none';
                backNipDisplay.style.cssText = `
                    font-size: ${this.state.fontSizes.other}px;
                    color: white;
                    font-family: ${this.state.fonts.other};
                `;
            }
            
            const backEmailDisplay = clone.querySelector('#backEmailDisplay');
            if (backEmailDisplay) {
                backEmailDisplay.textContent = document.getElementById('emailInput').value;
                backEmailDisplay.style.cssText = `
                    font-size: ${this.state.fontSizes.other}px;
                    color: white;
                    font-family: ${this.state.fonts.other};
                `;
            }
            
            const backPhoneDisplay = clone.querySelector('#backPhoneDisplay');
            if (backPhoneDisplay) {
                backPhoneDisplay.textContent = document.getElementById('phoneInput').value.replace(/-/g, ' - ');
                backPhoneDisplay.style.cssText = `
                    font-size: ${this.state.fontSizes.other}px;
                    color: white;
                    font-family: ${this.state.fonts.other};
                `;
            }
            
            const backPositionDisplay = clone.querySelector('#backPositionDisplay');
            if (backPositionDisplay) {
                backPositionDisplay.textContent = document.getElementById('positionInput').value;
                backPositionDisplay.style.cssText = `
                    font-size: ${this.state.fontSizes.other}px;
                    color: white;
                    font-family: ${this.state.fonts.other};
                `;
            }
            
            const backOfficeDisplay = clone.querySelector('#backOfficeDisplay');
            if (backOfficeDisplay) {
                backOfficeDisplay.textContent = document.getElementById('officeInput').value;
                backOfficeDisplay.style.cssText = `
                    font-size: ${this.state.fontSizes.other}px;
                    color: white;
                    font-family: ${this.state.fonts.other};
                `;
            }
            
            // QR container
            const qrContainer = clone.querySelector('.qr-container');
            if (qrContainer) {
                qrContainer.style.cssText = `
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    margin-top: auto;
                    flex-shrink: 0;
                `;
            }
            
            // QR code - regenerate untuk memastikan data terbaru
            const qrCode = clone.querySelector('.qr-code');
            if (qrCode) {
                qrCode.style.cssText = `
                    width: 180px;
                    height: 180px;
                    background: white;
                    border-radius: 15px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    box-shadow: 0 8px 25px rgba(0,0,0,0.3);
                    padding: 15px;
                    position: relative;
                `;
                
                // Clear dan regenerate QR code
                qrCode.innerHTML = '';
                const data = this.getFormData();
                const vcardData = `${data.name}\n${data.nip}\n${data.company}\n${data.position}\n${data.phone}\n${data.email}\n${data.office}\nCreate by : Sugandi,S.Kom`;
                
                new QRCode(qrCode, {
                    text: vcardData,
                    width: 170,
                    height: 170,
                    colorDark: "#000000",
                    colorLight: "#ffffff",
                    correctLevel: QRCode.CorrectLevel.H
                });
                
                const qrCanvas = qrCode.querySelector('canvas');
                if (qrCanvas) {
                    qrCanvas.style.cssText = `
                        display: block;
                        width: 100% !important;
                        height: 100% !important;
                    `;
                }
            }
        }

        _fixGreenSideBarsForDownload(clone) {
            const greenSideLeft = clone.querySelector('.green-side-left');
            const greenSideRight = clone.querySelector('.green-side-right');
            
            if (greenSideLeft) {
                greenSideLeft.style.cssText = `
                    position: absolute;
                    left: -96px;
                    top: 420px;
                    width: 232px;
                    height: 60px;
                    transform: rotate(-90deg);
                    transform-origin: center center;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    border-radius: 0 0 50px 0;
                    z-index: 0;
                    background: linear-gradient(135deg, ${this.state.sideBarColor} 0%, ${this.adjustColor(this.state.sideBarColor, -20)} 100%);
                `;
                
                // Tambahkan teks jabatan jika toggle aktif
                if (this.state.showPosition) {
                    const deptText = document.createElement('div');
                    deptText.className = 'dept-text';
                    deptText.textContent = document.getElementById('positionInput').value;
                    deptText.style.cssText = `
                        color: white;
                        font-weight: bold;
                        font-size: 16px;
                        padding: 10px 0;
                        font-family: ${this.state.fonts.other};
                    `;
                    greenSideLeft.appendChild(deptText);
                }
            }
            
            if (greenSideRight) {
                greenSideRight.style.cssText = `
                    position: absolute;
                    right: -96px;
                    top: 420px;
                    width: 232px;
                    height: 60px;
                    transform: rotate(90deg);
                    transform-origin: center center;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    border-radius: 0 0 0 50px;
                    z-index: 0;
                    background: linear-gradient(135deg, ${this.state.sideBarColor} 0%, ${this.adjustColor(this.state.sideBarColor, -20)} 100%);
                `;
                
                // Tambahkan teks jabatan jika toggle aktif
                if (this.state.showPosition) {
                    const deptText = document.createElement('div');
                    deptText.className = 'dept-text';
                    deptText.textContent = document.getElementById('positionInput').value;
                    deptText.style.cssText = `
                        color: white;
                        font-weight: bold;
                        font-size: 16px;
                        padding: 10px 0;
                        font-family: ${this.state.fonts.other};
                    `;
                    greenSideRight.appendChild(deptText);
                }
            }
        }

        _fixDecorativeElementsForDownload(clone) {
            const decorativeContainer = clone.querySelector('.decorative-circles');
            if (!decorativeContainer) return;
            
            // Hapus semua elemen lama
            decorativeContainer.innerHTML = '';
            
            // Salin semua elemen dekoratif dari state
            this.state.decorativeElements.front.forEach(element => {
                if (element.visible) {
                    const el = document.createElement('div');
                    el.className = `circle shape-${element.shape}`;
                    el.style.cssText = `
                        position: absolute;
                        width: ${element.size}px;
                        height: ${element.size}px;
                        left: ${element.x}px;
                        top: ${element.y}px;
                        background: ${element.color};
                        opacity: 0.6;
                        z-index: 0;
                        right: auto;
                        bottom: auto;
                        transition: none;
                    `;
                    
                    // Terapkan clip-path inline
                    this.applyClipPathInline(el, element.shape);
                    
                    decorativeContainer.appendChild(el);
                }
            });
        }

        _fixAllElementsForDownload(clone) {
            // Cek apakah ini kartu belakang
            const isBackCard = clone.classList.contains('card-back');
            
            // Jika kartu belakang, hapus semua elemen dekoratif
            if (isBackCard) {
                const decorativeContainer = clone.querySelector('.decorative-circles');
                if (decorativeContainer) {
                    decorativeContainer.remove();
                }
                
                const greenSideLeft = clone.querySelector('.green-side-left');
                const greenSideRight = clone.querySelector('.green-side-right');
                if (greenSideLeft) greenSideLeft.remove();
                if (greenSideRight) greenSideRight.remove();
            }
            
            // Header
            const header = clone.querySelector('.card-header');
            if (header) {
                header.style.cssText = `
                    flex-shrink: 0;
                    padding: 15px;
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    gap: 10px;
                    position: relative;
                    z-index: 2;
                `;
            }
            
            // Logo container
            const logoContainer = clone.querySelector('.logo-container');
            if (logoContainer) {
                logoContainer.style.cssText = `
                    width: 60px;
                    height: 60px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    border-radius: 10px;
                    overflow: hidden;
                    background: rgba(255,255,255,0.9);
                    border: 2px solid rgba(255,255,255,0.5);
                `;
            }
            
            // Logo image
            const logoImage = clone.querySelector('.logo-image');
            if (logoImage && this.state.logoUrl) {
                logoImage.src = this.state.logoUrl;
                logoImage.style.cssText = `
                    max-width: 100%;
                    max-height: 100%;
                    object-fit: contain;
                    display: block;
                `;
            }
            
            // Company name
            const companyName = clone.querySelector('.company-name');
            if (companyName) {
                companyName.textContent = document.getElementById('companyInput').value;
                companyName.style.cssText = `
                    font-size: ${this.state.fontSizes.company}px;
                    font-weight: bold;
                    color: ${this.state.template === 'plain' ? 'white' : '#333'};
                    font-family: ${this.state.fonts.company};
                    text-shadow: ${this.state.template === 'plain' ? '2px 2px 8px rgba(0,0,0,0.7)' : 'none'};
                `;
            }
            
            // Card image container
            const cardImageContainer = clone.querySelector('.card-image-container');
            if (cardImageContainer) {
                cardImageContainer.style.cssText = `
                    flex: 1;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    padding: 10px;
                    position: relative;
                    min-height: 0;
                    z-index: 1;
                `;
            }
            
            // Person image
            const personImage = clone.querySelector('.person-image');
            if (personImage) {
                personImage.style.cssText = `
                    width: 300px;
                    height: 350px;
                    max-width: 100%;
                    max-height: 100%;
                    flex-shrink: 0;
                    border-radius: 15px;
                    box-shadow: 0 10px 20px rgba(0,0,0,0.2);
                    overflow: hidden;
                    position: relative;
                `;
                
                const personImg = personImage.querySelector('img');
                if (personImg) {
                    if (this.state.photoUrl) {
                        personImg.src = this.state.photoUrl;
                    }
                    personImg.style.cssText = `
                        width: 100%;
                        height: 100%;
                        object-fit: cover;
                        display: block;
                    `;
                }
            }
            
            // Footer
            const footer = clone.querySelector('.card-footer');
            if (footer) {
                footer.style.cssText = `
                    flex-shrink: 0;
                    padding: 15px;
                    text-align: center;
                    position: relative;
                    z-index: 2;
                    ${this.state.template === 'decorative' ? 
                        `background: linear-gradient(135deg, ${document.getElementById('headerColorInput').value} 0%, ${this.adjustColor(document.getElementById('headerColorInput').value, 20)} 100%);` : 
                        'background: transparent;'}
                `;
            }
            
            // Name text
            const nameText = clone.querySelector('.name-text');
            if (nameText) {
                nameText.textContent = document.getElementById('nameInput').value;
                nameText.style.cssText = `
                    font-size: ${this.state.fontSizes.name}px;
                    font-weight: bold;
                    color: ${this.state.template === 'plain' ? 'white' : '#333'};
                    font-family: ${this.state.fonts.name};
                    text-shadow: ${this.state.template === 'plain' ? '2px 2px 8px rgba(0,0,0,0.7)' : '2px 2px 4px rgba(0,0,0,0.2)'};
                `;
            }
            
            // NIP text
            const nipText = clone.querySelector('.nip-text');
            if (nipText) {
                const nipValue = document.getElementById('nipInput').value;
                if (nipValue) {
                    nipText.textContent = `NIP: ${nipValue}`;
                    nipText.style.display = 'block';
                } else {
                    nipText.style.display = 'none';
                }
                nipText.style.cssText = `
                    font-size: ${this.state.fontSizes.other}px;
                    margin-top: 5px;
                    color: ${this.state.template === 'plain' ? 'white' : '#333'};
                    font-family: ${this.state.fonts.other};
                    text-shadow: ${this.state.template === 'plain' ? '2px 2px 8px rgba(0,0,0,0.7)' : '1px 1px 2px rgba(0,0,0,0.2)'};
                `;
            }
            
            // Green side bars dan dekoratif hanya untuk kartu depan
            if (!isBackCard && this.state.template === 'decorative') {
                this._fixGreenSideBarsForDownload(clone);
                this._fixDecorativeElementsForDownload(clone);
            }
            
            // Back card specific elements
            if (isBackCard) {
                this._fixBackCardElements(clone);
            }
        }

        applyClipPathInline(element, shape) {
            const clipPaths = {
                'circle': '50%',
                'square': '0',
                'triangle': 'polygon(50% 0%, 0% 100%, 100% 100%)',
                'hexagon': 'polygon(30% 0%, 70% 0%, 100% 30%, 100% 70%, 70% 100%, 30% 100%, 0% 70%, 0% 30%)',
                'star': 'polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%, 50% 0%)',
                'diamond': 'polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%)',
                'pentagon': 'polygon(50% 0%, 100% 38%, 82% 100%, 18% 100%, 0% 38%)',
                'heart': 'path("M12,21.35l-1.45-1.32C5.4,15.36,2,12.27,2,8.5C2,5.41,4.42,3,7.5,3c1.74,0,3.41,0.81,4.5,2.08C13.09,3.81,14.76,3,16.5,3C19.58,3,22,5.41,22,8.5c0,3.77-3.4,6.86-8.55,11.53L12,21.35z")',
                'arrow': 'polygon(0% 20%, 60% 20%, 60% 0%, 100% 50%, 60% 100%, 60% 80%, 0% 80%)',
                'cross': 'polygon(20% 0%, 80% 0%, 80% 20%, 100% 20%, 100% 80%, 80% 80%, 80% 100%, 20% 100%, 20% 80%, 0% 80%, 0% 20%, 20% 20%)'
            };
            
            // Hapus semua shape classes
            element.className = element.className.replace(/shape-\w+/g, '');
            
            if (shape === 'circle') {
                element.style.borderRadius = clipPaths[shape];
                element.style.clipPath = 'none';
                element.style.webkitClipPath = 'none';
            } else {
                element.style.borderRadius = '0';
                element.style.clipPath = clipPaths[shape];
                element.style.webkitClipPath = clipPaths[shape];
            }
            
            // Transformasi khusus untuk bentuk hati
            if (shape === 'heart') {
                element.style.transform = 'scale(2)';
            } else {
                element.style.transform = 'none';
            }
        }

        _triggerDownload(canvas, filename) {
            canvas.toBlob(blob => {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                setTimeout(() => URL.revokeObjectURL(url), 100);
            }, 'image/png');
        }

_generateFileName(side) {
    const name = document.getElementById('nameInput').value || 'kartu';
    const cleanName = name.replace(/\s+/g, '_');
    const suffix = side === 'front' ? '_Depan' : side === 'back' ? '_Belakang' : '_Kedua_Sisi';
    return `${cleanName}_ID_Card${suffix}.png`;
}

        // ============================================
        // UTILITY FUNCTIONS
        // ============================================
        handleKeyboard(e) {
            const activeElement = document.activeElement;
            const isInputFocused = activeElement && (activeElement.tagName === 'INPUT' || activeElement.tagName === 'TEXTAREA');
            
            if ((e.key === 'f' || e.key === 'F') && !isInputFocused) {
                e.preventDefault();
                this.flipCard();
            }
        }

        showLoading(text, showProgress = false) {
            this.elements.loadingText.textContent = text;
            this.elements.progressBar.style.display = showProgress ? 'block' : 'none';
            this.elements.progressFill.style.width = '0%';
            this.elements.loadingOverlay.style.display = 'flex';
        }

        updateProgress(percent) {
            this.elements.progressFill.style.width = `${percent}%`;
        }

        hideLoading() {
            this.elements.loadingOverlay.style.display = 'none';
        }

        showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed; top: 20px; right: 20px; background: ${type === 'error' ? 'var(--danger-gradient)' : 'var(--primary-gradient)'};
                color: white; padding: 15px 25px; border-radius: 10px; box-shadow: 0 5px 20px rgba(0,0,0,0.2);
                z-index: 10000; animation: slideIn 0.3s ease;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        adjustColor(color, amount) {
            const num = parseInt(color.replace('#', ''), 16);
            const r = Math.min(255, ((num >> 16) & 255) + amount);
            const g = Math.min(255, ((num >> 8) & 255) + amount);
            const b = Math.min(255, (num & 255) + amount);
            return '#' + ((r << 16) | (g << 8) | b).toString(16).padStart(6, '0');
        }

        _addPrintStyles() {
            const printStyle = document.createElement('style');
            printStyle.textContent = `
                @media print {
                    .decorative-circles {
                        display: block !important;
                        position: absolute !important;
                        width: 100% !important;
                        height: 100% !important;
                        pointer-events: none !important;
                        z-index: 0 !important;
                    }
                    .decorative-circles .circle {
                        display: block !important;
                        position: absolute !important;
                        opacity: 0.6 !important;
                    }
                }
            `;
            document.head.appendChild(printStyle);
        }
    }

    // Add animation styles
    const style = document.createElement('style');
    style.textContent = `
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes slideOut { from { transform: translateX(0); opacity: 1; } to { transform: translateX(100%); opacity: 0; } }
    `;
    document.head.appendChild(style);

    // Initialize the application
    const app = new IDCardMaker();
});
</script>
</body>
</html>
